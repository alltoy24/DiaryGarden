<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¸€ìˆ² - ê¸€ì´ ì •ì›ì„ ë§Œë“¤ë‹¤ (Evolution Dev)</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Nanum+Myeongjo:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Nanum+Myeongjo:wght@400;700&family=Nanum+Pen+Script&display=swap" rel="stylesheet">
    
    <style>
        /* --- [Diary ì „ìš© ìŠ¤íƒ€ì¼ ì •ë¦¬] --- */

        /* 1. ì¼ê¸° ì—´ê¸° ë²„íŠ¼ (ìš°ì¸¡ í•˜ë‹¨) */
        #diary-open-btn {
            position: fixed;
            bottom: 50px;
            right: 50px;
            z-index: 1000;
            background: transparent;
            border: none;
            color: #d4af37;
            font-family: 'Cinzel', serif;
            font-size: 1.1rem;
            letter-spacing: 0.2rem;
            cursor: pointer;
            opacity: 0; 
            visibility: hidden;
            transition: all 0.8s cubic-bezier(0.16, 1, 0.3, 1);
            display: flex;
            flex-direction: column;
            align-items: center;
            pointer-events: none;
        }

        #diary-open-btn.visible { 
            opacity: 0.7; 
            visibility: visible;
            pointer-events: auto; 
        }

        #diary-open-btn:hover { 
            opacity: 1; 
            transform: translateY(-5px); 
            text-shadow: 0 0 15px rgba(212, 175, 55, 0.6); 
        }

        .btn-line {
            width: 0%; height: 1px; background: #d4af37;
            transition: width 0.4s ease; margin-top: 5px;
        }
        #diary-open-btn:hover .btn-line { width: 100%; }

        /* 2. ì¼ê¸° ëª¨ë‹¬ ì „ì²´ ë°°ê²½ */
        #diary-modal {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(12px); /* ìˆ²ì´ ëª½í™˜ì ìœ¼ë¡œ ë¹„ì¹¨ */
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0; 
            visibility: hidden;
            pointer-events: none;
            transition: opacity 0.6s ease, visibility 0.6s ease;
        }

        #diary-modal.active {
            opacity: 1;
            visibility: visible;
            pointer-events: auto;
        }

        /* 3. ì¼ê¸° ì‘ì„± ì°½ (ë””ìì¸ í•µì‹¬) */
        .diary-window {
            width: 550px;
            background: linear-gradient(145deg, rgba(20, 25, 30, 0.95), rgba(10, 12, 15, 0.98));
            border: 1px solid rgba(212, 175, 55, 0.25);
            padding: 50px 40px;
            position: relative;
            box-shadow: 0 40px 100px rgba(0,0,0,0.9);
            display: flex;
            flex-direction: column;
            /* ì• ë‹ˆë©”ì´ì…˜: ì‚´ì§ ì•„ë˜ì—ì„œ ë¶€ë“œëŸ½ê²Œ ë– ì˜¤ë¦„ */
            transform: translateY(30px) scale(0.98);
            transition: transform 0.8s cubic-bezier(0.16, 1, 0.3, 1);
        }

        #diary-modal.active .diary-window {
            transform: translateY(0) scale(1);
        }

        .diary-header {
            margin-bottom: 25px;
            border-bottom: 1px solid rgba(212, 175, 55, 0.15);
            padding-bottom: 20px;
        }

        #diary-date-display {
            font-family: 'Cinzel', serif;
            font-size: 1.4rem;
            color: #ffd700;
            letter-spacing: 0.1rem;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.2);
        }

        /* 4. í…ìŠ¤íŠ¸ ì…ë ¥ ì˜ì—­ (ì¤‘ë³µ ìŠ¤íƒ€ì¼ í†µí•©) */
        #diary-textarea {
            width: 100%;
            height: 300px;
            background: rgba(255, 255, 255, 0.02);
            border: none;
            color: #e0e0e0;
            font-family: 'Nanum Pen Script', cursive;
            font-size: 1rem;
            line-height: 1.8;
            resize: none;
            outline: none;
            padding: 15px;
            transition: background 0.3s ease;
        }

        #diary-textarea:focus {
            background: rgba(255, 255, 255, 0.04);
        }

        #diary-textarea::placeholder {
            color: #555;
            font-family: 'Nanum Myeongjo', serif;
            font-size: 1rem;
        }

        /* 5. ë²„íŠ¼ ë° ê¸°íƒ€ ìš”ì†Œ */
        .char-counter {
            text-align: right;
            font-family: 'Cinzel', serif;
            font-size: 0.8rem;
            color: #666;
            margin-top: 15px;
        }

        .char-counter.invalid { color: #cc4444; }

        .diary-submit-btn {
            margin-top: 30px;
            background: transparent;
            border: 1px solid rgba(212, 175, 55, 0.4);
            color: #d4af37;
            font-family: 'Nanum Myeongjo', serif;
            font-size: 1rem;
            padding: 12px;
            cursor: pointer;
            transition: all 0.4s ease;
        }

        .diary-submit-btn:disabled { 
            border-color: #333; color: #444; cursor: not-allowed; 
        }

        .diary-submit-btn:not(:disabled):hover { 
            background: rgba(212, 175, 55, 0.1); 
            border-color: #d4af37;
            color: #fff;
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.15);
        }

        .close-modal {
            position: absolute;
            top: 20px; right: 25px;
            color: rgba(212, 175, 55, 0.5); 
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .close-modal:hover { 
            color: #d4af37; 
            transform: rotate(90deg); 
        }

        .close-modal {
            position: absolute;
            top: 15px; right: 20px;
            color: #888; cursor: pointer;
            font-family: sans-serif;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; cursor: default; }
        body, html { width: 100%; height: 100%; overflow: hidden; background-color: #000; }

        /* ì›”ë“œ ì»¨í…Œì´ë„ˆ */
        #world-container {
            position: relative; width: 100%; height: 100%;
            transition: transform 3.5s cubic-bezier(0.25, 1, 0.5, 1);
            transform-origin: center center; overflow: hidden; 
        }

        /* ë°°ê²½ */
        #sky-bg {
            position: absolute; top: -20%; left: -20%; width: 140%; height: 140%;
            background: linear-gradient(160deg, #0f2027 0%, #203a43 60%, #2c5364 100%);
            z-index: 1; transition: background 3s ease-in-out;
        }

        /* ë³„ (ë°¤) */
        #stars-container {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 2; pointer-events: none; opacity: 0; transition: opacity 3s ease-in-out;
        }
        .star {
            position: absolute; background-color: white; border-radius: 50%;
            box-shadow: 0 0 4px 1px rgba(255, 255, 255, 0.4);
            animation: twinkle var(--duration) ease-in-out infinite; opacity: var(--opacity);
        }
        @keyframes twinkle { 0%, 100% { opacity: var(--opacity); transform: scale(1); } 50% { opacity: 0.3; transform: scale(0.8); } }

        /* ë°”ë‹¥ ìš´í•´ */
        #cloud-floor {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 40%;
            background: linear-gradient(to top, rgba(255,255,255,0.95) 10%, rgba(220,230,255,0.8) 40%, rgba(255,255,255,0) 100%);
            z-index: 3; pointer-events: none; opacity: 0; transition: opacity 3s ease-in-out;
        }

        /* íŒŒí‹°í´ ìº”ë²„ìŠ¤ */
        #particle-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 4; pointer-events: none; }

        /* UI ë ˆì´ì–´ */
        #ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 100;
            padding: 60px; display: flex; flex-direction: column; justify-content: flex-start; align-items: flex-start;
            transition: opacity 1.5s ease-out; background: linear-gradient(to right, rgba(0,0,0,0.5) 0%, transparent 50%);
        }

        /* íˆ´íŒ */
        #cursor-tooltip {
            position: fixed; z-index: 200; top: 0; left: 0; pointer-events: none; opacity: 0;
            transform: translate(20px, -20px); transition: opacity 0.2s ease, transform 0.2s ease;
            display: flex; flex-direction: column; align-items: flex-start;
        }
        #cursor-tooltip.active { opacity: 1; transform: translate(25px, -25px); }
        .tooltip-line { width: 40px; height: 2px; background: #d4af37; margin-bottom: 5px; box-shadow: 0 0 8px rgba(212, 175, 55, 0.8); }
        #tooltip-kr { font-family: 'Nanum Myeongjo', serif; font-size: 1.5rem; color: #fff; font-weight: 700; text-shadow: 0 2px 10px rgba(0,0,0,0.8); letter-spacing: 0.1rem; line-height: 1; margin-bottom: 3px; }
        #tooltip-en { font-family: 'Cinzel', serif; font-size: 0.7rem; color: rgba(255, 255, 255, 0.7); letter-spacing: 0.2rem; text-transform: uppercase; }
        .tooltip-level { font-family: 'Cinzel', serif; font-size: 0.8rem; color: #ffd700; margin-top: 5px; } /* ë ˆë²¨ í‘œì‹œ ì¶”ê°€ */

        /* HUD */
        #hud-layer {
            position: fixed; top: 50px; left: 50px; z-index: 90; opacity: 0; transition: opacity 3s ease-in-out;
            font-family: 'Nanum Myeongjo', serif; color: rgba(255, 255, 255, 0.8);
            display: flex; align-items: center; pointer-events: none;
        }
        #hud-line { width: 1px; height: 35px; background-color: rgba(255,255,255,0.4); margin-right: 15px; }
        #hud-text-group { display: flex; flex-direction: column; }
        #hud-date { font-size: 0.8rem; letter-spacing: 0.1rem; opacity: 0.6; margin-bottom: 2px;}
        #hud-time { font-family: 'Cinzel', serif; font-size: 1.5rem; font-weight: 400; line-height: 1; }

        .title-group { margin-bottom: 50px; color: white; text-shadow: 0 2px 15px rgba(0,0,0,0.5); }
        h1.main-title { font-family: 'Nanum Myeongjo', serif; font-size: 5rem; font-weight: 700; letter-spacing: 0.3rem; margin-bottom: 10px; line-height: 1.1; }
        h2.sub-title { font-family: 'Nanum Myeongjo', serif; font-size: 1.2rem; font-weight: 400; opacity: 0.8; letter-spacing: 0.4rem; margin-left: 5px; }

        .enter-btn {
            background: transparent; border: 1px solid rgba(255,255,255,0.4); color: white; font-family: 'Nanum Myeongjo', serif; font-size: 1.1rem; cursor: pointer; padding: 10px 30px; margin-left: 5px; position: relative; opacity: 0.8; transition: all 0.3s;
        }
        .enter-btn:hover { opacity: 1; background: rgba(255,255,255,0.1); border-color: #fff; }

        /* --- ì„¬ ì»¨í…Œì´ë„ˆ --- */
        #islands-container {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; pointer-events: none; perspective: 1000px;
        }
        .scene-object {
            position: absolute; opacity: 0; transition: opacity 2s ease-in-out;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            will-change: transform; pointer-events: auto; cursor: pointer;
        }
        .scene-object.visible { opacity: 1; }

        .island img {
            width: 100%; height: auto;
            filter: drop-shadow(0 15px 25px rgba(0,0,0,0.6)) brightness(0.9);
            animation: float 6s ease-in-out infinite;
            /* ì´ë¯¸ì§€ êµì²´ì‹œ ë¶€ë“œëŸ½ê²Œ */
            transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1), filter 0.4s ease, opacity 0.3s ease; 
        }
        .island:hover img {
            transform: scale(1.1) translateY(-10px);
            filter: drop-shadow(0 30px 50px rgba(255,255,255,0.2)) brightness(1.3);
            z-index: 50;
        }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }

        /* ì„¬ ë°°ì¹˜ */
        #island-kindness { width: 90px; z-index: 20; top: 55%; left: 50%; transform: translate(-50%, 0); }
        #island-courage { width: 70px; z-index: 15; top: 50%; left: 38%; transform: translate(-50%, 0); }
        #island-diligence { width: 70px; z-index: 15; top: 50%; left: 62%; transform: translate(-50%, 0); }
        #island-wisdom { width: 50px; z-index: 10; top: 43%; left: 42%; transform: translate(-50%, 0); }
        #island-serenity { width: 50px; z-index: 10; top: 43%; left: 58%; transform: translate(-50%, 0); }

        /* ì¥ì‹ë¬¼ íŒŒí¸ */
        .shard {
            position: absolute;
            background: linear-gradient(135deg, rgba(255,255,255,0.4), rgba(255,255,255,0.05));
            box-shadow: 0 0 10px rgba(255,255,255,0.1);
            backdrop-filter: blur(2px);
            z-index: 5; pointer-events: none; opacity: 0; transition: opacity 2s;
            animation: shard-spin 15s linear infinite alternate;
        }
        .shard.visible { opacity: 0.6; }
        @keyframes shard-spin { 0% { transform: translateY(0) rotate(0deg); } 100% { transform: translateY(-20px) rotate(15deg); } }

        /* --- [ìˆ˜ì •] ê°œë°œììš© ì»¨íŠ¸ë¡¤ íŒ¨ë„: ì™¼ìª½ìœ¼ë¡œ ì´ë™ --- */
        #dev-panel {
            position: fixed; 
            bottom: 20px; 
            left: 20px; /* rightì—ì„œ leftë¡œ ë³€ê²½ */
            right: auto; /* ê¸°ì¡´ ìš°ì¸¡ ê³ ì • í•´ì œ */
            z-index: 9999;
            background: rgba(0, 0, 0, 0.7); 
            backdrop-filter: blur(5px);
            padding: 20px; 
            border-radius: 10px; 
            border: 1px solid rgba(212, 175, 55, 0.3);
            color: white; 
            font-family: sans-serif; 
            width: 250px;
            display: none; 
        }
        #dev-panel h3 { font-size: 14px; margin-bottom: 10px; color: #ffd700; border-bottom: 1px solid #555; padding-bottom: 5px; }
        .control-group { margin-bottom: 10px; display: flex; flex-direction: column; }
        .control-group label { font-size: 12px; margin-bottom: 2px; color: #ccc; display: flex; justify-content: space-between; }
        .control-group input[type="range"] { width: 100%; cursor: pointer; }
        .val-display { color: #fff; font-weight: bold; }

    </style>
</head>
<body>
    <audio id="bgm" src="SFX/bgm.mp3" loop></audio>
    <audio id="sfx-hover" src="SFX/hover.mp3"></audio>
    <audio id="sfx-click" src="SFX/click.mp3"></audio>
    <audio id="sfx-clear" src="SFX/cloud_clear.mp3"></audio>

    <div id="dev-panel">
        <h3>ğŸŒ± ì •ì›ì‚¬ ëª¨ë“œ (Point Controller)</h3>
        <div class="control-group">
            <label>ìš©ê¸° (Courage) <span id="val-courage" class="val-display">0</span></label>
            <input type="range" id="rng-courage" min="0" max="160" value="0">
        </div>
        <div class="control-group">
            <label>ì§€í˜œ (Wisdom) <span id="val-wisdom" class="val-display">0</span></label>
            <input type="range" id="rng-wisdom" min="0" max="160" value="0">
        </div>
        <div class="control-group">
            <label>ì¹œì ˆ (Kindness) <span id="val-kindness" class="val-display">0</span></label>
            <input type="range" id="rng-kindness" min="0" max="160" value="0">
        </div>
        <div class="control-group">
            <label>ì„±ì‹¤ (Diligence) <span id="val-diligence" class="val-display">0</span></label>
            <input type="range" id="rng-diligence" min="0" max="160" value="0">
        </div>
        <div class="control-group">
            <label>í‰ì˜¨ (Serenity) <span id="val-serenity" class="val-display">0</span></label>
            <input type="range" id="rng-serenity" min="0" max="160" value="0">
        </div>
        <div style="font-size: 10px; color:#888; margin-top:5px;">* ìŠ¬ë¼ì´ë”ë¥¼ ì›€ì§ì—¬ ì„¬ì„ ì§„í™”ì‹œí‚¤ì„¸ìš”.</div>
    </div>

    <div id="cursor-tooltip">
        <div class="tooltip-line"></div>
        <div id="tooltip-kr">í•œê¸€ ì´ë¦„</div>
        <div id="tooltip-en">English Name</div>
        <div class="tooltip-level" id="tooltip-lvl">Lv. 1</div>
    </div>

    <div id="hud-layer">
        <div id="hud-line"></div>
        <div id="hud-text-group">
            <div id="hud-date">...</div>
            <div id="hud-time">00:00</div>
        </div>
    </div>

    <div id="world-container">
        <div id="sky-bg"></div>
        <div id="stars-container"></div>
        <div id="cloud-floor"></div>
        <canvas id="particle-canvas"></canvas>

        <div id="islands-container">
            <div id="island-wisdom" class="scene-object island" 
                 data-depth="0.02" data-base-x="42" data-base-y="43" 
                 data-name-en="Wisdom" data-name-kr="ì§€í˜œ" data-type="wisdom" data-points="0">
                <img id="img-wisdom" src="Images/island_wisdom_1.png" alt="ì§€í˜œ">
            </div>

            <div id="island-serenity" class="scene-object island" 
                 data-depth="0.02" data-base-x="58" data-base-y="43" 
                 data-name-en="Serenity" data-name-kr="í‰ì˜¨" data-type="serenity" data-points="0">
                <img id="img-serenity" src="Images/island_serenity_1.png" alt="í‰ì˜¨">
            </div>

            <div id="island-courage" class="scene-object island" 
                 data-depth="0.04" data-base-x="38" data-base-y="50" 
                 data-name-en="Courage" data-name-kr="ìš©ê¸°" data-type="courage" data-points="0">
                <img id="img-courage" src="Images/island_courage_1.png" alt="ìš©ê¸°">
            </div>

            <div id="island-diligence" class="scene-object island" 
                 data-depth="0.04" data-base-x="62" data-base-y="50" 
                 data-name-en="Diligence" data-name-kr="ì„±ì‹¤" data-type="diligence" data-points="0">
                <img id="img-diligence" src="Images/island_diligence_1.png" alt="ì„±ì‹¤">
            </div>

            <div id="island-kindness" class="scene-object island" 
                 data-depth="0.07" data-base-x="50" data-base-y="55" 
                 data-name-en="Kindness" data-name-kr="ì¹œì ˆ" data-type="kindness" data-points="0">
                <img id="img-kindness" src="Images/island_kindness_1.png" alt="ì¹œì ˆ">
            </div>
        </div>
    </div>

    <div id="ui-layer">
        <div class="title-group">
            <h1 class="main-title">ê¸€ìˆ²</h1>
            <h2 class="sub-title">ê¸€ì´ ì •ì›ì„ ë§Œë“¤ë‹¤</h2>
        </div>
        <button id="enter-btn" class="enter-btn">ì •ì› ë“¤ì–´ê°€ê¸°</button>
    </div>
    <button id="diary-open-btn">
        WRITE DIARY
        <div class="btn-line"></div>
    </button>

    <div id="diary-modal">
        <div class="diary-window">
            <span class="close-modal" id="diary-close-x">âœ•</span>
            <div class="diary-header">
                <div id="diary-date-display">2024. 05. 21. TUE</div>
            </div>
            
            <textarea id="diary-textarea" placeholder="ì˜¤ëŠ˜ì˜ ì¼ë“¤ì„ ê¸°ë¡í•˜ì„¸ìš”... (100ì ~ 400ì)"></textarea>
            
            <div class="char-counter" id="char-count-info">0 / 400</div>
            
            <button id="diary-submit" class="diary-submit-btn" disabled>ë‚˜ë¬´ ì‹¬ê¸° (ê¸°ë¡)</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('particle-canvas');
        const ctx = canvas.getContext('2d');
        const worldContainer = document.getElementById('world-container');
        const uiLayer = document.getElementById('ui-layer');
        const enterBtn = document.getElementById('enter-btn');
        const islandElements = document.querySelectorAll('.island'); 
        const cloudFloor = document.getElementById('cloud-floor');
        const hudLayer = document.getElementById('hud-layer'); 
        const islandsContainer = document.getElementById('islands-container');
        const skyBg = document.getElementById('sky-bg');
        const starsContainer = document.getElementById('stars-container');
        const tooltip = document.getElementById('cursor-tooltip');
        const tooltipEn = document.getElementById('tooltip-en');
        const tooltipKr = document.getElementById('tooltip-kr');
        const tooltipLvl = document.getElementById('tooltip-lvl'); // ë ˆë²¨ íˆ´íŒ
        const devPanel = document.getElementById('dev-panel'); // ê°œë°œì íŒ¨ë„

        const audioBgm = document.getElementById('bgm');
        const audioHover = document.getElementById('sfx-hover');
        const audioClick = document.getElementById('sfx-click');
        const audioClear = document.getElementById('sfx-clear');
        const hudDate = document.getElementById('hud-date');
        const hudTime = document.getElementById('hud-time');

        // --- ìš”ì†Œ ì„ íƒ ---
        const diaryOpenBtn = document.getElementById('diary-open-btn');
        const diaryModal = document.getElementById('diary-modal');
        const diaryCloseX = document.getElementById('diary-close-x');
        const diaryTextarea = document.getElementById('diary-textarea');
        const charCounter = document.getElementById('char-count-info');
        const diarySubmitBtn = document.getElementById('diary-submit');
        const diaryDateDisplay = document.getElementById('diary-date-display');

        // --- 1. ë²„íŠ¼ í˜¸ë²„ íš¨ê³¼ìŒ (ê¸°ì¡´ ì˜¤ë””ì˜¤ ì¬í™œìš©) ---
        diaryOpenBtn.addEventListener('mouseenter', () => {
            const sound = audioHover.cloneNode();
            sound.volume = 0.4;
            sound.play().catch(()=>{});
        });

        // --- 2. ëª¨ë‹¬ ì—´ê¸°/ë‹«ê¸° ---
        diaryOpenBtn.addEventListener('click', () => {
            audioClick.play();
            diaryModal.classList.add('active');
            // ëª¨ë‹¬ ì—´ ë•Œ í˜„ì¬ ì‹œê°„ ì—…ë°ì´íŠ¸
            const now = new Date();
            diaryDateDisplay.innerText = `${now.getFullYear()}. ${String(now.getMonth()+1).padStart(2,'0')}. ${String(now.getDate()).padStart(2,'0')}. ${['SUN','MON','TUE','WED','THU','FRI','SAT'][now.getDay()]}`;
        });

        // --- 3. ê¸€ì ìˆ˜ ê²€ì¦ ë¡œì§ (100ì ~ 400ì) ---
        diaryTextarea.addEventListener('input', () => {
            const len = diaryTextarea.value.length;
            charCounter.innerText = `${len} / 400`;

            // ê¸°íšì„œ ë°¸ëŸ°ì‹± ê¸°ì¤€: ìµœì†Œ 100ì, ìµœëŒ€ 400ì [cite: 3, 17]
            if (len >= 100 && len <= 400) {
                diarySubmitBtn.disabled = false;
                charCounter.classList.remove('invalid');
            } else {
                diarySubmitBtn.disabled = true;
                charCounter.classList.add('invalid');
            }
        });

        // --- 4. ë“±ë¡ ë²„íŠ¼ í´ë¦­ (ì„±ì¥ ì‹œìŠ¤í…œê³¼ ì—°ë™ ì¤€ë¹„) ---
        diarySubmitBtn.addEventListener('click', () => {
            audioClick.play();
            alert("ìˆ²ì— ì¼ê¸°ê°€ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤. ë•ëª© í¬ì¸íŠ¸ê°€ ë¶„ì„ë©ë‹ˆë‹¤.");
            // ì—¬ê¸°ì— ë‚˜ì¤‘ì— OpenAI API ë¶„ì„ ë° í¬ì¸íŠ¸ ë¶„ë°° ë¡œì§ì´ ë“¤ì–´ê°‘ë‹ˆë‹¤ [cite: 4, 5]
            diaryModal.classList.remove('active');
            diaryTextarea.value = '';
        });

        diaryCloseX.addEventListener('click', () => { 
            // [ì¤‘ìš”] style.display = 'none' ëŒ€ì‹  í´ë˜ìŠ¤ ì œê±°!
            diaryModal.classList.remove('active'); 
        });

        diaryModal.addEventListener('click', (e) => {
            if (e.target === diaryModal) {
                diaryModal.classList.remove('active');
            }
        });

        // [í•µì‹¬] í¬ì¸íŠ¸ì— ë”°ë¥¸ ë ˆë²¨ ê³„ì‚° í•¨ìˆ˜ 
        function calculateLevel(points) {
            if (points <= 15) return 1;
            if (points <= 30) return 2;
            if (points <= 45) return 3;
            if (points <= 60) return 4;
            if (points <= 75) return 5;
            if (points <= 90) return 6;
            if (points <= 105) return 7;
            if (points <= 125) return 8;
            if (points <= 150) return 9;
            return 10; // Max [cite: 43]
        }

        // [í•µì‹¬] ì„¬ ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateIslandVisual(type, points) {
            const level = calculateLevel(points);
            const imgElement = document.getElementById(`img-${type}`);
            const parentElement = document.getElementById(`island-${type}`);
            
            // ë°ì´í„° ì—…ë°ì´íŠ¸
            parentElement.dataset.points = points;
            
            // ì´ë¯¸ì§€ ì†ŒìŠ¤ êµì²´ (íŒŒì¼ëª… ê·œì¹™: island_type_level.png)
            const newSrc = `Images/island_${type}_${level}.png`;
            
            // í˜„ì¬ ì´ë¯¸ì§€ì™€ ë‹¤ë¥¼ ë•Œë§Œ êµì²´ (ë¶ˆí•„ìš”í•œ ë¦¬ë¡œë“œ ë°©ì§€)
            if (!imgElement.src.includes(newSrc)) {
                // í˜ì´ë“œ íš¨ê³¼ë¥¼ ìœ„í•´ íˆ¬ëª…ë„ ì¡°ì ˆ
                imgElement.style.opacity = 0;
                setTimeout(() => {
                    imgElement.src = newSrc;
                    imgElement.onload = () => {
                        imgElement.style.opacity = 1;
                    };
                    // ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨ ì‹œ(íŒŒì¼ ì—†ì„ ë•Œ) 1ë ˆë²¨ë¡œ ë¡¤ë°±í•˜ëŠ” ì•ˆì „ì¥ì¹˜
                    imgElement.onerror = () => {
                        imgElement.src = `Images/island_${type}_1.png`;
                        imgElement.style.opacity = 1;
                    }
                }, 300);
            }
        }

        // [NEW] ìŠ¬ë¼ì´ë” ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        const virtues = ['courage', 'wisdom', 'kindness', 'diligence', 'serenity'];
        virtues.forEach(v => {
            const slider = document.getElementById(`rng-${v}`);
            const display = document.getElementById(`val-${v}`);
            
            slider.addEventListener('input', (e) => {
                const points = parseInt(e.target.value);
                display.innerText = points;
                updateIslandVisual(v, points);
            });
        });


        // ... (ì´í•˜ ê¸°ì¡´ íŒŒí‹°í´, ì‹œê°„, íŒŒëŸ´ë™ìŠ¤ ë¡œì§ ìœ ì§€) ...

        function createStars() {
            const count = 100;
            for(let i=0; i<count; i++) {
                const star = document.createElement('div');
                star.classList.add('star');
                const x = Math.random() * 100;
                const y = Math.random() * 70; 
                const size = Math.random() * 2 + 1;
                const duration = Math.random() * 3 + 2; 
                const opacity = Math.random() * 0.7 + 0.3;
                star.style.left = `${x}%`; star.style.top = `${y}%`;
                star.style.width = `${size}px`; star.style.height = `${size}px`;
                star.style.setProperty('--duration', `${duration}s`);
                star.style.setProperty('--opacity', opacity);
                starsContainer.appendChild(star);
            }
        }
        createStars();

        function updateDayNightCycle() {
            let now;
            if (window.manualTime) { now = new Date(); now.setHours(window.manualTime.h, window.manualTime.m); } else { now = new Date(); }
            const year = now.getFullYear(); const month = String(now.getMonth() + 1).padStart(2, '0'); const date = String(now.getDate()).padStart(2, '0');
            const days = ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT']; const dayName = days[now.getDay()];
            hudDate.innerText = `${year}. ${month}. ${date}. ${dayName}`;
            const hours = String(now.getHours()).padStart(2, '0'); const minutes = String(now.getMinutes()).padStart(2, '0');
            hudTime.innerText = `${hours}:${minutes}`;
            const h = now.getHours();
            let skyGradient = ''; let starsOpacity = 0;
            if (h >= 5 && h < 7) { skyGradient = 'linear-gradient(135deg, #2c3e50 0%, #4ca1af 60%, #ff9966 100%)'; starsOpacity = 0; }
            else if (h >= 7 && h < 17) { skyGradient = 'linear-gradient(135deg, #2980b9 0%, #6dd5fa 50%, #ffffff 100%)'; starsOpacity = 0; }
            else if (h >= 17 && h < 19) { skyGradient = 'linear-gradient(135deg, #3e5151 0%, #decba4 50%, #ff7e5f 100%)'; starsOpacity = 0.3; }
            else { skyGradient = 'linear-gradient(160deg, #0f2027 0%, #203a43 60%, #2c5364 100%)'; starsOpacity = 1; }
            skyBg.style.background = skyGradient; starsContainer.style.opacity = starsOpacity;
        }
        setInterval(updateDayNightCycle, 1000); updateDayNightCycle(); 

        let width, height;
        function resize() { width = window.innerWidth; height = window.innerHeight; canvas.width = width; canvas.height = height; }
        window.addEventListener('resize', resize); resize();

        let mouseX = 0; let mouseY = 0; let targetX = 0; let targetY = 0;
        const parallaxSensitivity = 0.2; 
        document.addEventListener('mousemove', (e) => {
            mouseX = (e.clientX - width / 2) / (width / 2);
            mouseY = (e.clientY - height / 2) / (height / 2);
            tooltip.style.left = e.clientX + 'px'; tooltip.style.top = e.clientY + 'px';
        });

        function updateParallax() {
            targetX += (mouseX - targetX) * 0.05; targetY += (mouseY - targetY) * 0.05;
            const allObjects = document.querySelectorAll('.scene-object');
            allObjects.forEach(obj => {
                const depth = parseFloat(obj.dataset.depth); const baseX = parseFloat(obj.dataset.baseX); const baseY = parseFloat(obj.dataset.baseY);
                const moveX = targetX * depth * width * -1 * parallaxSensitivity; const moveY = targetY * depth * height * -1 * parallaxSensitivity;
                obj.style.left = `${baseX}%`; obj.style.top = `${baseY}%`; obj.style.transform = `translate(calc(-50% + ${moveX}px), ${moveY}px)`;
            });
            requestAnimationFrame(updateParallax);
        }

        function createShards() {
            const shardCount = 20;
            for(let i=0; i<shardCount; i++) {
                const shard = document.createElement('div'); shard.classList.add('shard', 'scene-object'); 
                const size = 5 + Math.random() * 20; shard.style.width = `${size}px`; shard.style.height = `${size}px`;
                shard.dataset.baseX = Math.random() * 100; shard.dataset.baseY = Math.random() * 90; shard.dataset.depth = (Math.random() * 0.1).toFixed(3); 
                const p1 = Math.floor(Math.random() * 100); const p2 = Math.floor(Math.random() * 100); const p3 = Math.floor(Math.random() * 100);
                shard.style.clipPath = `polygon(${p1}% 0%, 100% ${p2}%, ${p3}% 100%)`; shard.style.animationDelay = `${Math.random() * 5}s`;
                islandsContainer.appendChild(shard);
            }
        }
        createShards(); 

        islandElements.forEach(island => {
            island.addEventListener('mouseenter', () => {
                if(island.classList.contains('visible')) {
                    const sound = audioHover.cloneNode(); sound.volume = 0.6; sound.play().catch(()=>{});
                    tooltipEn.innerText = island.dataset.nameEn;
                    tooltipKr.innerText = island.dataset.nameKr;
                    
                    // íˆ´íŒì— í˜„ì¬ ë ˆë²¨ í‘œì‹œ ì¶”ê°€
                    const points = parseInt(island.dataset.points);
                    const lvl = calculateLevel(points);
                    tooltipLvl.innerText = `Lv. ${lvl} (${points}pts)`;
                    
                    tooltip.classList.add('active');
                }
            });
            island.addEventListener('mouseleave', () => { tooltip.classList.remove('active'); });
        });

        let particles = []; const particleCount = 200; let isClearing = false; let isGardenMode = false;
        class Particle {
            constructor(isIntro = true) { this.isIntro = isIntro; this.markedForDeletion = false; this.reset(true); }
            reset(initial = false) {
                if (this.isIntro) {
                    this.x = Math.random() * width; this.y = Math.random() * height; this.z = Math.random(); 
                    this.size = 100 + this.z * 300; this.speed = 0.5 + this.z * 0.5; this.opacity = 0.4 + Math.random() * 0.5;
                    this.vx = this.speed; this.vy = 0; this.type = 'cloud';
                } else {
                    this.x = width + 50; const rand = Math.random();
                    if (rand < 0.8) { this.y = (height * 0.7) + Math.random() * (height * 0.3); } else { this.y = Math.random() * (height * 0.5); }
                    const typeRand = Math.random();
                    if (typeRand > 0.8) { this.type = 'mini-cloud'; this.size = 30 + Math.random() * 60; this.speed = 0.5 + Math.random() * 0.5; this.opacity = 0.15 + Math.random() * 0.2; } 
                    else { this.type = 'wind'; this.size = 1 + Math.random() * 2; this.speed = 2.5 + Math.random() * 2; this.opacity = 0.05 + Math.random() * 0.1; }
                    this.vx = -this.speed; this.vy = (Math.random() - 0.5) * 0.2;
                }
                this.explodeVx = 0; this.explodeVy = 0;
            }
            update() {
                if (this.isIntro) {
                    if (!isClearing) { this.x += this.vx; if (this.x - this.size > width) { this.x = -this.size; this.y = Math.random() * height; } } 
                    else {
                        const centerX = width / 2; const centerY = height / 2; const dx = this.x - centerX; const dy = this.y - centerY;
                        const angle = Math.atan2(dy, dx); const force = 8; 
                        this.explodeVx += Math.cos(angle) * 0.8; this.explodeVy += Math.sin(angle) * 0.8;
                        this.x += (Math.cos(angle) * force) + this.explodeVx; this.y += (Math.sin(angle) * force) + this.explodeVy;
                        this.opacity -= 0.02; if (this.opacity <= 0) { this.markedForDeletion = true; }
                    }
                } else {
                    this.x += this.vx; this.y += this.vy; if (this.x < -200) { this.markedForDeletion = true; }
                }
            }
            draw() {
                if (this.opacity <= 0) return; ctx.beginPath();
                if (this.type === 'cloud' || this.type === 'mini-cloud') {
                    const gradient = ctx.createRadialGradient(this.x, this.y, this.size * 0.1, this.x, this.y, this.size);
                    gradient.addColorStop(0, `rgba(255, 255, 255, ${this.opacity})`); gradient.addColorStop(0.6, `rgba(240, 248, 255, ${this.opacity * 0.5})`); gradient.addColorStop(1, `rgba(255, 255, 255, 0)`);
                    ctx.fillStyle = gradient; ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2); ctx.fill();
                } else if (this.type === 'wind') {
                    ctx.strokeStyle = `rgba(255, 255, 255, ${this.opacity})`; ctx.lineWidth = 1;
                    ctx.moveTo(this.x, this.y); ctx.lineTo(this.x + this.size * 15, this.y); ctx.stroke();
                }
            }
        }

        function initIntroParticles() { for (let i = 0; i < particleCount; i++) particles.push(new Particle(true)); }
        function spawnGardenParticles() { if (!isGardenMode) return; if (particles.length < 100) { particles.push(new Particle(false)); } }
        function animateParticles() {
            ctx.clearRect(0, 0, width, height); for (let i = 0; i < particles.length; i++) { particles[i].update(); particles[i].draw(); }
            particles = particles.filter(p => !p.markedForDeletion);
            if (isGardenMode) { spawnGardenParticles(); }
            requestAnimationFrame(animateParticles);
        }

        enterBtn.addEventListener('mouseenter', () => { const sound = audioHover.cloneNode(); sound.volume = 0.5; sound.play().catch(()=>{}); });
        enterBtn.addEventListener('click', () => {
            // 1. ì¦‰ì‹œ ì‹¤í–‰: í´ë¦­ íš¨ê³¼ìŒ, ì¸íŠ¸ë¡œ UI í˜ì´ë“œì•„ì›ƒ, ì›”ë“œ í™•ëŒ€(ì§„ì…) ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘
            audioClick.play();
            uiLayer.style.opacity = '0';
            isClearing = true;
            worldContainer.style.transform = "scale(2.0)"; 

            // 2. 1ì´ˆ ë’¤: ë³¸ê²©ì ìœ¼ë¡œ ì •ì›ì˜ ìš”ì†Œë“¤ì„ í™”ë©´ì— ë°°ì¹˜
            setTimeout(() => {
                isGardenMode = true;

                // ëª¨ë“  ì„¬ê³¼ ì¥ì‹ íŒŒí¸ë“¤ í‘œì‹œ
                const allSceneObjects = document.querySelectorAll('.scene-object');
                allSceneObjects.forEach((obj) => { 
                    obj.classList.add('visible'); 
                });

                // [ì¤‘ìš”] ì¼ê¸° ì“°ê¸° ë²„íŠ¼ ë“±ì¥
                if (diaryOpenBtn) {
                    diaryOpenBtn.classList.add('visible');
                }

                // êµ¬ë¦„ ë°”ë‹¥, HUD, ê°œë°œì íŒ¨ë„(ìŠ¬ë¼ì´ë”) í‘œì‹œ
                cloudFloor.style.opacity = '1'; 
                hudLayer.style.opacity = '1'; 
                devPanel.style.display = 'block'; // íŒ¨ë„ ë“±ì¥ (CSSì—ì„œ ìœ„ì¹˜ëŠ” ì™¼ìª½ìœ¼ë¡œ!)

                // ì‹œì•¼ ì‹œì°¨(Parallax) íš¨ê³¼ ì‹œì‘
                updateParallax();
            }, 1000);

            // 3. 1.5ì´ˆ ë’¤: ì¸íŠ¸ë¡œ UI ë ˆì´ì–´ë¥¼ ì™„ì „íˆ ì œê±°í•´ì„œ í´ë¦­ ë°©í•´ë¥¼ ë§‰ìŒ
            setTimeout(() => { 
                uiLayer.style.display = 'none'; 
            }, 1500);

            // 4. íš¨ê³¼ìŒ ë° ë°°ê²½ìŒì•… íƒ€ì´ë° ì¡°ì ˆ
            setTimeout(() => { 
                audioClear.volume = 1.0; 
                audioClear.play(); 
            }, 2500);

            setTimeout(() => { 
                audioBgm.volume = 0.4; 
                audioBgm.play(); 
            }, 8000);
        });

        initIntroParticles(); animateParticles();
    </script>
</body>
</html>