<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¸€ìˆ² - ê¸€ì´ ì •ì›ì„ ë§Œë“¤ë‹¤ (Evolution Dev)</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Nanum+Myeongjo:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Nanum+Myeongjo:wght@400;700&family=Nanum+Pen+Script&display=swap" rel="stylesheet">
    
    <style>
        /* --- [Diary ì „ìš© ìŠ¤íƒ€ì¼ ì •ë¦¬] --- */

        /* 1. ì¼ê¸° ì—´ê¸° ë²„íŠ¼ (ìš°ì¸¡ í•˜ë‹¨) */
        #diary-open-btn {
            position: fixed;
            bottom: 50px;
            right: 50px;
            z-index: 1000;
            background: transparent;
            border: none;
            color: #d4af37;
            font-family: 'Cinzel', serif;
            font-size: 1.1rem;
            letter-spacing: 0.2rem;
            cursor: pointer;
            opacity: 0; 
            visibility: hidden;
            transition: all 0.8s cubic-bezier(0.16, 1, 0.3, 1);
            display: flex;
            flex-direction: column;
            align-items: center;
            pointer-events: none;
        }

        #diary-open-btn.visible { 
            opacity: 0.7; 
            visibility: visible;
            pointer-events: auto; 
        }

        #diary-open-btn:hover { 
            opacity: 1; 
            transform: translateY(-5px); 
            text-shadow: 0 0 15px rgba(212, 175, 55, 0.6); 
        }

        .btn-line {
            width: 0%; height: 1px; background: #d4af37;
            transition: width 0.4s ease; margin-top: 5px;
        }
        #diary-open-btn:hover .btn-line { width: 100%; }

        /* 2. ì¼ê¸° ëª¨ë‹¬ ì „ì²´ ë°°ê²½ */
        #diary-modal {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(12px); /* ìˆ²ì´ ëª½í™˜ì ìœ¼ë¡œ ë¹„ì¹¨ */
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0; 
            visibility: hidden;
            pointer-events: none;
            transition: opacity 0.6s ease, visibility 0.6s ease;
        }

        #diary-modal.active {
            opacity: 1;
            visibility: visible;
            pointer-events: auto;
        }

        /* 3. ì¼ê¸° ì‘ì„± ì°½ (ë””ìì¸ í•µì‹¬) */
        .diary-window {
            width: 550px;
            background: linear-gradient(145deg, rgba(20, 25, 30, 0.95), rgba(10, 12, 15, 0.98));
            border: 1px solid rgba(212, 175, 55, 0.25);
            padding: 50px 40px;
            position: relative;
            box-shadow: 0 40px 100px rgba(0,0,0,0.9);
            display: flex;
            flex-direction: column;
            /* ì• ë‹ˆë©”ì´ì…˜: ì‚´ì§ ì•„ë˜ì—ì„œ ë¶€ë“œëŸ½ê²Œ ë– ì˜¤ë¦„ */
            transform: translateY(30px) scale(0.98);
            transition: transform 0.8s cubic-bezier(0.16, 1, 0.3, 1);
        }

        #diary-modal.active .diary-window {
            transform: translateY(0) scale(1);
        }

        .diary-header {
            margin-bottom: 25px;
            border-bottom: 1px solid rgba(212, 175, 55, 0.15);
            padding-bottom: 20px;
        }

        #diary-date-display {
            font-family: 'Cinzel', serif;
            font-size: 1.4rem;
            color: #ffd700;
            letter-spacing: 0.1rem;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.2);
        }

        /* 4. í…ìŠ¤íŠ¸ ì…ë ¥ ì˜ì—­ (ì¤‘ë³µ ìŠ¤íƒ€ì¼ í†µí•©) */
        #diary-textarea {
            width: 100%;
            height: 300px;
            background: rgba(255, 255, 255, 0.02);
            border: none;
            color: #e0e0e0;
            font-family: 'Nanum Pen Script', cursive;
            font-size: 1rem;
            line-height: 1.8;
            resize: none;
            outline: none;
            padding: 15px;
            transition: background 0.3s ease;
        }

        #diary-textarea:focus {
            background: rgba(255, 255, 255, 0.04);
        }

        #diary-textarea::placeholder {
            color: #555;
            font-family: 'Nanum Myeongjo', serif;
            font-size: 1rem;
        }

        /* 5. ë²„íŠ¼ ë° ê¸°íƒ€ ìš”ì†Œ */
        .char-counter {
            text-align: right;
            font-family: 'Cinzel', serif;
            font-size: 0.8rem;
            color: #666;
            margin-top: 15px;
        }

        .char-counter.invalid { color: #cc4444; }

        .diary-submit-btn {
            margin-top: 30px;
            background: transparent;
            border: 1px solid rgba(212, 175, 55, 0.4);
            color: #d4af37;
            font-family: 'Nanum Myeongjo', serif;
            font-size: 1rem;
            padding: 12px;
            cursor: pointer;
            transition: all 0.4s ease;
        }

        .diary-submit-btn:disabled { 
            border-color: #333; color: #444; cursor: not-allowed; 
        }

        .diary-submit-btn:not(:disabled):hover { 
            background: rgba(212, 175, 55, 0.1); 
            border-color: #d4af37;
            color: #fff;
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.15);
        }

        .close-modal {
            position: absolute;
            top: 20px; right: 25px;
            color: rgba(212, 175, 55, 0.5); 
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .close-modal:hover { 
            color: #d4af37; 
            transform: rotate(90deg); 
        }

        .close-modal {
            position: absolute;
            top: 15px; right: 20px;
            color: #888; cursor: pointer;
            font-family: sans-serif;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; cursor: default; }
        body, html { width: 100%; height: 100%; overflow: hidden; background-color: #000; }

        /* ì›”ë“œ ì»¨í…Œì´ë„ˆ */
        #world-container {
            position: relative; width: 100%; height: 100%;
            transition: transform 3.5s cubic-bezier(0.25, 1, 0.5, 1);
            transform-origin: center center; overflow: hidden; 
        }

        /* ë°°ê²½ */
        #sky-bg {
            position: absolute; top: -20%; left: -20%; width: 140%; height: 140%;
            background: linear-gradient(160deg, #0f2027 0%, #203a43 60%, #2c5364 100%);
            z-index: 1; transition: background 3s ease-in-out;
        }

        /* ë³„ (ë°¤) */
        #stars-container {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 2; pointer-events: none; opacity: 0; transition: opacity 3s ease-in-out;
        }
        .star {
            position: absolute; background-color: white; border-radius: 50%;
            box-shadow: 0 0 4px 1px rgba(255, 255, 255, 0.4);
            animation: twinkle var(--duration) ease-in-out infinite; opacity: var(--opacity);
        }
        @keyframes twinkle { 0%, 100% { opacity: var(--opacity); transform: scale(1); } 50% { opacity: 0.3; transform: scale(0.8); } }

        /* ë°”ë‹¥ ìš´í•´ */
        #cloud-floor {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 40%;
            background: linear-gradient(to top, rgba(255,255,255,0.95) 10%, rgba(220,230,255,0.8) 40%, rgba(255,255,255,0) 100%);
            z-index: 3; pointer-events: none; opacity: 0; transition: opacity 3s ease-in-out;
        }

        /* íŒŒí‹°í´ ìº”ë²„ìŠ¤ */
        #particle-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 4; pointer-events: none; }

        /* UI ë ˆì´ì–´ */
        #ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 100;
            padding: 60px; display: flex; flex-direction: column; justify-content: flex-start; align-items: flex-start;
            transition: opacity 1.5s ease-out; background: linear-gradient(to right, rgba(0,0,0,0.5) 0%, transparent 50%);
        }

        /* íˆ´íŒ */
        #cursor-tooltip {
            position: fixed; z-index: 200; top: 0; left: 0; pointer-events: none; opacity: 0;
            transform: translate(20px, -20px); transition: opacity 0.2s ease, transform 0.2s ease;
            display: flex; flex-direction: column; align-items: flex-start;
        }
        #cursor-tooltip.active { opacity: 1; transform: translate(25px, -25px); }
        .tooltip-line { width: 40px; height: 2px; background: #d4af37; margin-bottom: 5px; box-shadow: 0 0 8px rgba(212, 175, 55, 0.8); }
        #tooltip-kr { font-family: 'Nanum Myeongjo', serif; font-size: 1.5rem; color: #fff; font-weight: 700; text-shadow: 0 2px 10px rgba(0,0,0,0.8); letter-spacing: 0.1rem; line-height: 1; margin-bottom: 3px; }
        #tooltip-en { font-family: 'Cinzel', serif; font-size: 0.7rem; color: rgba(255, 255, 255, 0.7); letter-spacing: 0.2rem; text-transform: uppercase; }
        .tooltip-level { font-family: 'Cinzel', serif; font-size: 0.8rem; color: #ffd700; margin-top: 5px; } /* ë ˆë²¨ í‘œì‹œ ì¶”ê°€ */

        /* HUD */
        #hud-layer {
            position: fixed; top: 50px; left: 50px; z-index: 90; opacity: 0; transition: opacity 3s ease-in-out;
            font-family: 'Nanum Myeongjo', serif; color: rgba(255, 255, 255, 0.8);
            display: flex; align-items: center; pointer-events: none;
        }
        #hud-line { width: 1px; height: 35px; background-color: rgba(255,255,255,0.4); margin-right: 15px; }
        #hud-text-group { display: flex; flex-direction: column; }
        #hud-date { font-size: 0.8rem; letter-spacing: 0.1rem; opacity: 0.6; margin-bottom: 2px;}
        #hud-time { font-family: 'Cinzel', serif; font-size: 1.5rem; font-weight: 400; line-height: 1; }

        .title-group { margin-bottom: 50px; color: white; text-shadow: 0 2px 15px rgba(0,0,0,0.5); }
        h1.main-title { font-family: 'Nanum Myeongjo', serif; font-size: 5rem; font-weight: 700; letter-spacing: 0.3rem; margin-bottom: 10px; line-height: 1.1; }
        h2.sub-title { font-family: 'Nanum Myeongjo', serif; font-size: 1.2rem; font-weight: 400; opacity: 0.8; letter-spacing: 0.4rem; margin-left: 5px; }

        .enter-btn {
            background: transparent; border: 1px solid rgba(255,255,255,0.4); color: white; font-family: 'Nanum Myeongjo', serif; font-size: 1.1rem; cursor: pointer; padding: 10px 30px; margin-left: 5px; position: relative; opacity: 0.8; transition: all 0.3s;
        }
        .enter-btn:hover { opacity: 1; background: rgba(255,255,255,0.1); border-color: #fff; }

        /* --- ì„¬ ì»¨í…Œì´ë„ˆ --- */
        #islands-container {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; pointer-events: none; perspective: 1000px;
        }
        .scene-object {
            position: absolute; opacity: 0; transition: opacity 2s ease-in-out;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            will-change: transform; pointer-events: auto; cursor: pointer;
        }
        .scene-object.visible { opacity: 1; }

        .island img {
            width: 100%; height: auto;
            filter: drop-shadow(0 15px 25px rgba(0,0,0,0.6)) brightness(0.9);
            animation: float 6s ease-in-out infinite;
            /* ì´ë¯¸ì§€ êµì²´ì‹œ ë¶€ë“œëŸ½ê²Œ */
            transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1), filter 0.4s ease, opacity 0.3s ease; 
        }
        .island:hover img {
            transform: scale(1.1) translateY(-10px);
            filter: drop-shadow(0 30px 50px rgba(255,255,255,0.2)) brightness(1.3);
            z-index: 50;
        }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }

        /* ì„¬ ë°°ì¹˜ */
        #island-kindness { width: 90px; z-index: 20; top: 55%; left: 50%; transform: translate(-50%, 0); }
        #island-courage { width: 70px; z-index: 15; top: 50%; left: 38%; transform: translate(-50%, 0); }
        #island-diligence { width: 70px; z-index: 15; top: 50%; left: 62%; transform: translate(-50%, 0); }
        #island-wisdom { width: 50px; z-index: 10; top: 43%; left: 42%; transform: translate(-50%, 0); }
        #island-serenity { width: 50px; z-index: 10; top: 43%; left: 58%; transform: translate(-50%, 0); }

        /* ì¥ì‹ë¬¼ íŒŒí¸ */
        .shard {
            position: absolute;
            background: linear-gradient(135deg, rgba(255,255,255,0.4), rgba(255,255,255,0.05));
            box-shadow: 0 0 10px rgba(255,255,255,0.1);
            backdrop-filter: blur(2px);
            z-index: 5; pointer-events: none; opacity: 0; transition: opacity 2s;
            animation: shard-spin 15s linear infinite alternate;
        }
        .shard.visible { opacity: 0.6; }
        @keyframes shard-spin { 0% { transform: translateY(0) rotate(0deg); } 100% { transform: translateY(-20px) rotate(15deg); } }

        /* --- [ìˆ˜ì •] ê°œë°œììš© ì»¨íŠ¸ë¡¤ íŒ¨ë„: ì™¼ìª½ìœ¼ë¡œ ì´ë™ --- */
        #dev-panel {
            position: fixed; 
            bottom: 20px; 
            left: 20px; /* rightì—ì„œ leftë¡œ ë³€ê²½ */
            right: auto; /* ê¸°ì¡´ ìš°ì¸¡ ê³ ì • í•´ì œ */
            z-index: 9999;
            background: rgba(0, 0, 0, 0.7); 
            backdrop-filter: blur(5px);
            padding: 20px; 
            border-radius: 10px; 
            border: 1px solid rgba(212, 175, 55, 0.3);
            color: white; 
            font-family: sans-serif; 
            width: 250px;
            display: none; 
        }
        #dev-panel h3 { font-size: 14px; margin-bottom: 10px; color: #ffd700; border-bottom: 1px solid #555; padding-bottom: 5px; }
        .control-group { margin-bottom: 10px; display: flex; flex-direction: column; }
        .control-group label { font-size: 12px; margin-bottom: 2px; color: #ccc; display: flex; justify-content: space-between; }
        .control-group input[type="range"] { width: 100%; cursor: pointer; }
        .val-display { color: #fff; font-weight: bold; }

        #island-info-panel {
            position: fixed; top: 0; right: -400px; /* ì˜¤ë¥¸ìª½ ë°–ì— ìˆ¨ê¸°ê¸° */
            width: 380px; height: 100%;
            background: rgba(10, 12, 15, 0.95); /* ê²€ì€ìƒ‰ ë°°ê²½ */
            border-left: 1px solid rgba(212, 175, 55, 0.3);
            backdrop-filter: blur(10px);
            z-index: 5000;
            padding: 40px 30px;
            display: flex; flex-direction: column;
            transition: right 0.6s cubic-bezier(0.16, 1, 0.3, 1);
            box-shadow: -10px 0 30px rgba(0,0,0,0.5);
        }
        #island-info-panel.active { right: 0; }

        /* 2. íŒ¨ë„ ë‚´ë¶€ íƒ€ì´í¬ê·¸ë˜í”¼ */
        #panel-close-btn {
            position: absolute; top: 20px; right: 20px;
            background: none; border: none; color: #666; font-size: 1.5rem; cursor: pointer; transition: color 0.3s;
        }
        #panel-close-btn:hover { color: #d4af37; }

        .panel-header { margin-bottom: 30px; text-align: left; }
        #panel-title-kr { font-family: 'Nanum Myeongjo', serif; font-size: 2.5rem; color: #fff; margin-bottom: 5px; }
        #panel-title-en { font-family: 'Cinzel', serif; font-size: 0.9rem; color: #d4af37; letter-spacing: 0.2rem; text-transform: uppercase; }

        .panel-stats { margin-bottom: 30px; }
        .stat-row { display: flex; justify-content: space-between; margin-bottom: 10px; font-family: 'Cinzel', serif; font-size: 0.9rem; color: #ccc; }
        .stat-value { color: #ffd700; font-weight: bold; }
        .stat-bar-bg { width: 100%; height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px; margin-top: 10px; }
        .stat-bar-fill { height: 100%; background: #d4af37; width: 0%; transition: width 1s ease; box-shadow: 0 0 10px rgba(212, 175, 55, 0.5); }

        .panel-divider { width: 100%; height: 1px; background: linear-gradient(to right, transparent, rgba(212, 175, 55, 0.5), transparent); margin-bottom: 30px; }

        /* 3. ì¼ê¸° ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
        .panel-history h4 { font-family: 'Nanum Myeongjo', serif; color: #aaa; font-size: 0.9rem; margin-bottom: 15px; }
        #panel-diary-list { list-style: none; overflow-y: auto; max-height: 60vh; padding-right: 5px; }
        /* ìŠ¤í¬ë¡¤ë°” ì»¤ìŠ¤í…€ */
        #panel-diary-list::-webkit-scrollbar { width: 4px; }
        #panel-diary-list::-webkit-scrollbar-thumb { background: #333; border-radius: 2px; }

        .diary-item {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.05);
            padding: 15px; margin-bottom: 10px;
            border-radius: 5px; transition: all 0.3s ease;
        }
        .diary-item:hover { background: rgba(255,255,255,0.07); border-color: rgba(212, 175, 55, 0.3); transform: translateX(5px); }
        .diary-date { font-family: 'Cinzel', serif; font-size: 0.7rem; color: #d4af37; margin-bottom: 5px; display: block; }
        .diary-snippet { font-family: 'Nanum Myeongjo', serif; font-size: 0.9rem; color: #ddd; line-height: 1.4; }


        /* --- [í•µì‹¬] ì›”ë“œ ì§‘ì¤‘ ëª¨ë“œ (World Focus Mode) --- */

        /* ì§‘ì¤‘ ëª¨ë“œ ì‹œ ê¸°ì¡´ UI íˆ¬ëª…í™” */
        .world-focused #hud-layer, 
        .world-focused #diary-open-btn,
        .world-focused #cursor-tooltip { 
            opacity: 0 !important; pointer-events: none; transition: opacity 0.5s ease; 
        }

        /* ì„ íƒë˜ì§€ ì•Šì€ ì„¬ë“¤: êµ¬ë¦„ì²˜ëŸ¼ í¼ì§€ë©° ì‚¬ë¼ì§ */
        .world-focused .island:not(.focused-island) {
            opacity: 0 !important;
            transform: translate(-50%, -100px) scale(1.5) !important; /* ìœ„ë¡œ ì˜¬ë¼ê°€ë©° ì»¤ì§ */
            filter: blur(10px);
            pointer-events: none;
            transition: all 1s ease;
        }

        .world-focused .island.focused-island {
            /* ê¸°ì¡´ 25%ëŠ” ë„ˆë¬´ ì™¼ìª½ì…ë‹ˆë‹¤. íŒ¨ë„(380px)ì„ ëº€ ê³µê°„ì˜ ì¤‘ì•™ì„ ê³„ì‚°í•©ë‹ˆë‹¤. */
            left: calc(50% - 190px) !important; 
            top: 50% !important;
            
            /* í™•ëŒ€ ë¹„ìœ¨ì„ 2.5ë°°ì—ì„œ 1.8ë°° ì •ë„ë¡œ ì‚´ì§ ì¤„ì—¬ì„œ ì•ˆì •ê°ì„ ì¤ë‹ˆë‹¤. */
            transform: translate(-50%, -50%) scale(1.8) !important; 
            
            z-index: 1000;
            filter: drop-shadow(0 0 50px rgba(255, 215, 0, 0.5)); /* í›„ê´‘ ë” ê°•í•˜ê²Œ */
            transition: all 1.2s cubic-bezier(0.19, 1, 0.22, 1);
        }
        /* --- [NEW] ê²°ê³¼ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ --- */
        #result-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(15px);
            z-index: 6000; display: flex; justify-content: center; align-items: center;
            opacity: 0; visibility: hidden; transition: all 0.8s ease;
        }
        #result-modal.active { opacity: 1; visibility: visible; }

        .result-window {
            width: 650px; padding: 60px;
            background: linear-gradient(145deg, rgba(25, 30, 35, 0.9), rgba(10, 12, 15, 1));
            border: 1px solid rgba(212, 175, 55, 0.3);
            box-shadow: 0 0 50px rgba(0,0,0,1);
            text-align: center; position: relative;
            transform: translateY(50px); transition: transform 0.8s cubic-bezier(0.16, 1, 0.3, 1);
        }
        #result-modal.active .result-window { transform: translateY(0); }

        .result-subtitle { font-family: 'Cinzel', serif; color: #d4af37; letter-spacing: 0.3rem; font-size: 0.8rem; }
        .result-title { font-family: 'Nanum Myeongjo', serif; font-size: 2.2rem; color: #fff; margin-top: 10px; margin-bottom: 40px; }

        .result-content {
            font-family: 'Nanum Myeongjo', serif; color: #ccc; line-height: 2; text-align: left;
            max-height: 300px; overflow-y: auto; padding-right: 15px; margin-bottom: 40px; font-size: 1.05rem;
        }

        /* í¬ì¸íŠ¸ ì•„ì´ì½˜ ìƒ‰ìƒ ì •ì˜ */
        #result-point-up-area { display: flex; justify-content: center; gap: 15px; margin-bottom: 40px; flex-wrap: wrap; }
        .point-badge {
            padding: 8px 15px; border-radius: 20px; font-family: 'Cinzel', serif; font-size: 0.85rem;
            font-weight: bold; animation: fadeInUp 0.5s ease forwards; opacity: 0;
        }

        /* ê° ë•ëª©ë³„ ì»¬ëŸ¬ (ìœ¤í˜¸ë‹˜ì´ ì›í•˜ì‹  ëŒ€ë¡œ!) */
        .badge-courage { border: 1px solid #ff6b6b; color: #ff6b6b; box-shadow: 0 0 10px rgba(255, 107, 107, 0.2); }
        .badge-wisdom { border: 1px solid #4db8ff; color: #4db8ff; box-shadow: 0 0 10px rgba(77, 184, 255, 0.2); }
        .badge-kindness { border: 1px solid #ff85a2; color: #ff85a2; box-shadow: 0 0 10px rgba(255, 133, 162, 0.2); }
        .badge-diligence { border: 1px solid #2ecc71; color: #2ecc71; box-shadow: 0 0 10px rgba(46, 204, 113, 0.2); }
        .badge-serenity { border: 1px solid #81ecec; color: #81ecec; box-shadow: 0 0 10px rgba(129, 236, 236, 0.2); }

        #result-close-btn {
            background: transparent; border: 1px solid rgba(255,255,255,0.2); color: #fff;
            padding: 12px 40px; font-family: 'Nanum Myeongjo', serif; cursor: pointer; transition: 0.3s;
        }
        #result-close-btn:hover { background: #fff; color: #000; border-color: #fff; }

        /* 1. ì—ë„ˆì§€ êµ¬ìŠ¬ (ë” ê°•ë ¥í•œ ë°œê´‘ê³¼ ê¼¬ë¦¬ íš¨ê³¼) */
        .energy-orb {
            position: fixed;
            width: 30px; height: 30px; /* í¬ê¸° ì•½ê°„ í‚¤ì›€ */
            background: radial-gradient(circle at 30% 30%, #fff, var(--orb-color));
            border-radius: 50%;
            z-index: 7000; pointer-events: none;
            /* í•µì‹¬: ë‹¤ì¤‘ ê·¸ë¦¼ìë¡œ ë¹› ë²ˆì§ + ê¼¬ë¦¬ íš¨ê³¼ ì—°ì¶œ */
            box-shadow: 
                0 0 20px var(--orb-color),
                0 0 40px var(--orb-color),
                0 0 80px var(--orb-color);
            opacity: 0; transform: scale(0); /* ì‹œì‘ ì „ ìˆ¨ê¹€ */
            will-change: transform, left, top; /* ì„±ëŠ¥ ìµœì í™” */
        }

        /* 2. êµ¬ìŠ¬ ì´ë™ ì• ë‹ˆë©”ì´ì…˜ (ì§ì„  -> ê³¡ì„  ëŠë‚Œì˜ ê°€ê°ì†) */
        .energy-orb.flying {
            opacity: 1; transform: scale(1);
            /* í•µì‹¬ ë² ì§€ì— ê³¡ì„ : ì²˜ìŒì—” í­ë°œì ìœ¼ë¡œ ë¹ ë¥´ë‹¤ê°€ ì¤‘ê°„ì— ì‚´ì§ ëŠë ¤ì§€ê³ ,
            ë„ì°© ì§ì „ì— ë‹¤ì‹œ ë¹ ë¥´ê²Œ ê½‚íˆëŠ” ëŠë‚Œ (ë¡œì¼“ ë°œì‚¬ ëŠë‚Œ)
            */
            transition: 
                left 1.2s cubic-bezier(0.25, 0.1, 0.25, 1.2),
                top 1.2s cubic-bezier(0.25, 0.1, 0.25, 1.2),
                transform 0.3s ease-out,
                opacity 0.3s ease-in;
        }

        .impact-ripple {
            position: absolute; top: 50%; left: 50%;
            width: 20px; height: 20px; /* ì‘ê²Œ ì‹œì‘ */
            border-radius: 50%;
            /* ì„ ì´ ì•„ë‹ˆë¼ ë©´ìœ¼ë¡œ í¼ì§€ëŠ” ë¹›ì˜ ëŠë‚Œ */
            background: radial-gradient(circle, var(--orb-color) 0%, transparent 70%);
            filter: blur(8px); /* ëª½í™˜ì ì¸ ëŠë‚Œì„ ìœ„í•´ ë¸”ëŸ¬ ì²˜ë¦¬ */
            transform: translate(-50%, -50%) scale(1);
            opacity: 0.8;
            pointer-events: none; z-index: 999;
        }

        .impact-ripple.active {
            /* ë” ë¹ ë¥´ê³  ìš°ì•„í•˜ê²Œ í©ì–´ì§ */
            animation: rippleBurst 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        @keyframes rippleBurst {
            to { transform: translate(-50%, -50%) scale(8); opacity: 0; }
        }

        /* 2. í¬ì¸íŠ¸ í…ìŠ¤íŠ¸ (í¬ê¸° ì¶•ì†Œ ë° ê°€ë…ì„± í–¥ìƒ) */
        .floating-point {
            position: absolute; top: -30px; left: 50%;
            transform: translateX(-50%) scale(0);
            color: #fff;
            font-family: 'Cinzel', serif; 
            font-weight: 800; 
            font-size: 0.7rem; /* 2rem -> 1.1remìœ¼ë¡œ ì¶•ì†Œ */
            letter-spacing: 0.1rem;
            pointer-events: none; z-index: 1002;
            text-shadow: 0 0 10px var(--orb-color), 0 2px 4px rgba(0,0,0,0.8);
            white-space: nowrap;
        }

        /* 4. ì„¬ ë°œê´‘ (ë” ê°•ë ¬í•˜ê²Œ) */
        @keyframes island-flash-strong {
            0% { filter: brightness(1) contrast(1); transform: scale(1); }
            30% { filter: brightness(2.5) contrast(1.2) drop-shadow(0 0 50px var(--orb-color)); transform: scale(1.05); }
            100% { filter: brightness(1) contrast(1); transform: scale(1); }
        }
        .flash-effect { animation: island-flash-strong 0.7s ease-out; }

        /* ì«€ë“í•œ ë“±ì¥ ì• ë‹ˆë©”ì´ì…˜ */
        .floating-point.pop {
            animation: popUpElastic 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
        }
        /* ì‚¬ë¼ì§€ëŠ” ì• ë‹ˆë©”ì´ì…˜ */
        .floating-point.fade {
            transition: all 0.5s ease-out;
            opacity: 0; transform: translate(-50%, -50px) scale(0.8);
        }

        @keyframes popUpElastic {
            0% { opacity: 0; transform: translate(-50%, 20px) scale(0.5); }
            60% { opacity: 1; transform: translate(-50%, -10px) scale(1.3); } /* ì‚´ì§ ì˜¤ë²„í•´ì„œ ì»¤ì§ */
            100% { opacity: 1; transform: translate(-50%, 0) scale(1); } /* ì œìë¦¬ */
        }
    </style>
</head>
<body>
    <audio id="sfx-hover" src="SFX/hover.mp3"></audio>
    <audio id="sfx-click" src="SFX/click.mp3"></audio>
    <audio id="sfx-clear" src="SFX/cloud_clear.mp3"></audio>
    <audio id="sfx-ambiance" src="SFX/ambiance.mp3" loop></audio>
    <audio id="sfx-result" src="SFX/result.mp3"></audio>
    <audio id="sfx-hit" src="SFX/hit.mp3"></audio>

    <div id="dev-panel">
        <h3>ğŸŒ± ì •ì›ì‚¬ ëª¨ë“œ (Point Controller)</h3>
        <div class="control-group">
            <label>ìš©ê¸° (Courage) <span id="val-courage" class="val-display">0</span></label>
            <input type="range" id="rng-courage" min="0" max="160" value="0">
        </div>
        <div class="control-group">
            <label>ì§€í˜œ (Wisdom) <span id="val-wisdom" class="val-display">0</span></label>
            <input type="range" id="rng-wisdom" min="0" max="160" value="0">
        </div>
        <div class="control-group">
            <label>ì¹œì ˆ (Kindness) <span id="val-kindness" class="val-display">0</span></label>
            <input type="range" id="rng-kindness" min="0" max="160" value="0">
        </div>
        <div class="control-group">
            <label>ì„±ì‹¤ (Diligence) <span id="val-diligence" class="val-display">0</span></label>
            <input type="range" id="rng-diligence" min="0" max="160" value="0">
        </div>
        <div class="control-group">
            <label>í‰ì˜¨ (Serenity) <span id="val-serenity" class="val-display">0</span></label>
            <input type="range" id="rng-serenity" min="0" max="160" value="0">
        </div>
        <div style="font-size: 10px; color:#888; margin-top:5px;">* ìŠ¬ë¼ì´ë”ë¥¼ ì›€ì§ì—¬ ì„¬ì„ ì§„í™”ì‹œí‚¤ì„¸ìš”.</div>
    </div>

    <div id="cursor-tooltip">
        <div class="tooltip-line"></div>
        <div id="tooltip-kr">í•œê¸€ ì´ë¦„</div>
        <div id="tooltip-en">English Name</div>
        <div class="tooltip-level" id="tooltip-lvl">Lv. 1</div>
    </div>

    <div id="hud-layer">
        <div id="hud-line"></div>
        <div id="hud-text-group">
            <div id="hud-date">...</div>
            <div id="hud-time">00:00</div>
        </div>
    </div>

    <div id="world-container">
        <div id="sky-bg"></div>
        <div id="stars-container"></div>
        <div id="cloud-floor"></div>
        <canvas id="particle-canvas"></canvas>

        <div id="islands-container">
            <div id="island-wisdom" class="scene-object island" 
                 data-depth="0.02" data-base-x="42" data-base-y="43" 
                 data-name-en="Wisdom" data-name-kr="ì§€í˜œ" data-type="wisdom" data-points="0">
                <img id="img-wisdom" src="Images/island_wisdom_1.png" alt="ì§€í˜œ">
            </div>

            <div id="island-serenity" class="scene-object island" 
                 data-depth="0.02" data-base-x="58" data-base-y="43" 
                 data-name-en="Serenity" data-name-kr="í‰ì˜¨" data-type="serenity" data-points="0">
                <img id="img-serenity" src="Images/island_serenity_1.png" alt="í‰ì˜¨">
            </div>

            <div id="island-courage" class="scene-object island" 
                 data-depth="0.04" data-base-x="38" data-base-y="50" 
                 data-name-en="Courage" data-name-kr="ìš©ê¸°" data-type="courage" data-points="0">
                <img id="img-courage" src="Images/island_courage_1.png" alt="ìš©ê¸°">
            </div>

            <div id="island-diligence" class="scene-object island" 
                 data-depth="0.04" data-base-x="62" data-base-y="50" 
                 data-name-en="Diligence" data-name-kr="ì„±ì‹¤" data-type="diligence" data-points="0">
                <img id="img-diligence" src="Images/island_diligence_1.png" alt="ì„±ì‹¤">
            </div>

            <div id="island-kindness" class="scene-object island" 
                 data-depth="0.07" data-base-x="50" data-base-y="55" 
                 data-name-en="Kindness" data-name-kr="ì¹œì ˆ" data-type="kindness" data-points="0">
                <img id="img-kindness" src="Images/island_kindness_1.png" alt="ì¹œì ˆ">
            </div>
        </div>
    </div>

    <div id="ui-layer">
        <div class="title-group">
            <h1 class="main-title">ê¸€ìˆ²</h1>
            <h2 class="sub-title">ê¸€ì´ ì •ì›ì„ ë§Œë“¤ë‹¤</h2>
        </div>
        <button id="enter-btn" class="enter-btn">ì •ì› ë“¤ì–´ê°€ê¸°</button>
    </div>
    
    <aside id="island-info-panel">
        <button id="panel-close-btn">âœ•</button>
        
        <div class="panel-header">
            <h2 id="panel-title-kr">ì§€í˜œì˜ ì •ì›</h2>
            <h3 id="panel-title-en">Garden of Wisdom</h3>
        </div>

        <div class="panel-stats">
            <div class="stat-row">
                <span class="stat-label">CURRENT LEVEL</span>
                <span class="stat-value" id="panel-lvl">Lv. 3</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">TOTAL POINTS</span>
                <span class="stat-value" id="panel-pts">450</span>
            </div>
            <div class="stat-bar-bg"><div id="panel-progress-bar" class="stat-bar-fill"></div></div>
        </div>

        <div class="panel-divider"></div>

        <div class="panel-history">
            <h4>ê¸°ë¡ëœ ì–‘ë¶„ (Diary Log)</h4>
            <ul id="panel-diary-list">
                </ul>
        </div>
    </aside>

    <button id="diary-open-btn">
        WRITE DIARY
        <div class="btn-line"></div>
    </button>

    <div id="diary-modal">
        <div class="diary-window">
            <span class="close-modal" id="diary-close-x">âœ•</span>
            <div class="diary-header">
                <div id="diary-date-display">2024. 05. 21. TUE</div>
            </div>
            
            <textarea id="diary-textarea" placeholder="ì˜¤ëŠ˜ì˜ ì¼ë“¤ì„ ê¸°ë¡í•˜ì„¸ìš”... (30ì ~ 200ì)"></textarea>
            
            <div class="char-counter" id="char-count-info">0 / 200</div>
            
            <button id="diary-submit" class="diary-submit-btn" disabled>ë‚˜ë¬´ ì‹¬ê¸° (ê¸°ë¡)</button>
        </div>
    </div>
    <div id="result-modal">
        <div class="result-window">
            <div class="result-header">
                <span class="result-subtitle">THE GARDENER'S INSIGHT</span>
                <h2 class="result-title">ì •ì›ì‚¬ì˜ ë‹µì¥</h2>
            </div>
            
            <div class="result-content" id="result-comment">
                </div>

            <div class="result-footer">
                <div id="result-point-up-area">
                    </div>
                <button id="result-close-btn">ì •ì›ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('particle-canvas');
        const ctx = canvas.getContext('2d');
        const worldContainer = document.getElementById('world-container');
        const uiLayer = document.getElementById('ui-layer');
        const enterBtn = document.getElementById('enter-btn');
        const islandElements = document.querySelectorAll('.island'); 
        const cloudFloor = document.getElementById('cloud-floor');
        const hudLayer = document.getElementById('hud-layer'); 
        const islandsContainer = document.getElementById('islands-container');
        const skyBg = document.getElementById('sky-bg');
        const starsContainer = document.getElementById('stars-container');
        const tooltip = document.getElementById('cursor-tooltip');
        const tooltipEn = document.getElementById('tooltip-en');
        const tooltipKr = document.getElementById('tooltip-kr');
        const tooltipLvl = document.getElementById('tooltip-lvl'); // ë ˆë²¨ íˆ´íŒ
        const devPanel = document.getElementById('dev-panel'); // ê°œë°œì íŒ¨ë„

        const audioHover = document.getElementById('sfx-hover');
        const audioClick = document.getElementById('sfx-click');
        const audioClear = document.getElementById('sfx-clear');
        const audioAmbiance = document.getElementById('sfx-ambiance');
        const hudDate = document.getElementById('hud-date');
        const hudTime = document.getElementById('hud-time');

        // --- ìš”ì†Œ ì„ íƒ ---
        const diaryOpenBtn = document.getElementById('diary-open-btn');
        const diaryModal = document.getElementById('diary-modal');
        const diaryCloseX = document.getElementById('diary-close-x');
        const diaryTextarea = document.getElementById('diary-textarea');
        const charCounter = document.getElementById('char-count-info');
        const diarySubmitBtn = document.getElementById('diary-submit');
        const diaryDateDisplay = document.getElementById('diary-date-display');

        const sidePanel = document.getElementById('island-info-panel');
        const panelCloseBtn = document.getElementById('panel-close-btn');
        const panelDiaryList = document.getElementById('panel-diary-list');
        const resultModal = document.getElementById('result-modal');
        const resultComment = document.getElementById('result-comment');
        const resultPointUpArea = document.getElementById('result-point-up-area');
        const resultCloseBtn = document.getElementById('result-close-btn');
        const audioResult = document.getElementById('sfx-result');
        const audioHit = document.getElementById('sfx-hit');

        // ëˆ„ì  ì ìˆ˜ ìƒíƒœ ê´€ë¦¬
        let currentPoints = {
            courage: 0, wisdom: 0, kindness: 0, diligence: 0, serenity: 0
        };

        let currentLastResult = null;

        const virtueColors = {
            courage: '#ff6b6b', wisdom: '#4db8ff', kindness: '#ff85a2',
            diligence: '#2ecc71', serenity: '#81ecec'
        };

        // ë”ë¯¸ ë°ì´í„° (ë‚˜ì¤‘ì—” ì‹¤ì œ ì¼ê¸° ë°ì´í„°ì™€ ì—°ë™)
        const islandData = {
            'wisdom': { 
                kr: 'ì§€í˜œì˜ ì •ì›', en: 'Garden of Wisdom', 
                logs: [
                    { date: '2024.05.20', text: 'ì˜¤ëŠ˜ì€ ìƒˆë¡œìš´ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ë¥¼ ë°°ì› ë‹¤. ì–´ë µì§€ë§Œ ì›ë¦¬ë¥¼ ê¹¨ë‹«ëŠ” ê³¼ì •ì´ ì¦ê±°ì› ë‹¤.' },
                    { date: '2024.05.18', text: 'ì±…ì„ ì½ë‹¤ê°€ ë¬¸ë“ ë‚´ ì‚¶ì˜ ë°©í–¥ì„±ì— ëŒ€í•œ íŒíŠ¸ë¥¼ ì–»ì—ˆë‹¤.' }
                ] 
            },
            'courage': { 
                kr: 'ìš©ê¸°ì˜ ì •ì›', en: 'Garden of Courage', 
                logs: [
                    { date: '2024.05.21', text: 'ë°œí‘œ ê³µí¬ì¦ì´ ìˆì—ˆì§€ë§Œ ì†ì„ ë“¤ê³  ë‚´ ì˜ê²¬ì„ ë§í–ˆë‹¤. ì‹¬ì¥ì´ í„°ì§ˆ ê²ƒ ê°™ì•˜ì§€ë§Œ í•´ëƒˆë‹¤.' }
                ] 
            },
            'kindness': { kr: 'ì¹œì ˆì˜ ì •ì›', en: 'Garden of Kindness', logs: [] },
            'diligence': { kr: 'ì„±ì‹¤ì˜ ì •ì›', en: 'Garden of Diligence', logs: [] },
            'serenity': { kr: 'í‰ì˜¨ì˜ ì •ì›', en: 'Garden of Serenity', logs: [] }
        };

        async function realAnalyzeDiary(diaryText) {
            // ğŸ‘‡ ìœ¤í˜¸ë‹˜ì˜ Render ì„œë²„ ì£¼ì†Œë¡œ ì—°ê²°í•©ë‹ˆë‹¤.
            const url = "https://guelforest-server.onrender.com/analyze"; 

            const response = await fetch(url, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                    // ğŸ” Authorization í—¤ë” ì‚­ì œ! (ì´ì œ API í‚¤ëŠ” ì„œë²„ì— ìˆìœ¼ë‹ˆê¹Œìš”)
                },
                body: JSON.stringify({
                    diaryText: diaryText // ì„œë²„ë¡œ 'ì¼ê¸° ë‚´ìš©'ë§Œ ê°€ë³ê²Œ ë³´ëƒ…ë‹ˆë‹¤.
                })
            });

            if (!response.ok) {
                const errData = await response.json();
                throw new Error(errData.error || "ì„œë²„ í†µì‹  ì‹¤íŒ¨");
            }

            // ì„œë²„ê°€ ì´ë¯¸ ë¶„ì„í•´ì„œ ê¹”ë”í•œ JSONì„ ë³´ë‚´ì£¼ë¯€ë¡œ ë°”ë¡œ ë¦¬í„´!
            return await response.json(); 
        }

        // --- [í•µì‹¬] ì„¬ í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ìˆ˜ì • ---
        islandElements.forEach(island => {
            // 1. í˜¸ë²„ íš¨ê³¼ (ê¸°ì¡´ ìœ ì§€)
            island.addEventListener('mouseenter', () => {
                // ì§‘ì¤‘ ëª¨ë“œê°€ ì•„ë‹ ë•Œë§Œ íˆ´íŒ í‘œì‹œ
                if(!document.body.classList.contains('world-focused') && island.classList.contains('visible')) {
                    const sound = audioHover.cloneNode(); sound.volume = 0.1; sound.play().catch(()=>{});
                    tooltipEn.innerText = island.dataset.nameEn;
                    tooltipKr.innerText = island.dataset.nameKr;
                    const points = parseInt(island.dataset.points);
                    const lvl = calculateLevel(points);
                    tooltipLvl.innerText = `Lv. ${lvl} (${points}pts)`;
                    tooltip.classList.add('active');
                }
            });
            island.addEventListener('mouseleave', () => { tooltip.classList.remove('active'); });

            // 2. [NEW] í´ë¦­ ì‹œ ì§‘ì¤‘ ëª¨ë“œ (Focus Mode) ì§„ì…
            island.addEventListener('click', (e) => {
                // ì´ë¯¸ ì§‘ì¤‘ ëª¨ë“œë¼ë©´ ë¬´ì‹œ
                if (document.body.classList.contains('world-focused')) return;

                e.stopPropagation(); // ë°°ê²½ í´ë¦­ ì´ë²¤íŠ¸ ì „íŒŒ ë°©ì§€
                const type = island.dataset.type;
                const points = parseInt(island.dataset.points);
                const level = calculateLevel(points);

                // 1) íš¨ê³¼ìŒ ì¬ìƒ
                audioClick.play();

                // 2) ì›”ë“œ ìƒíƒœ ë³€ê²½ (CSS ì• ë‹ˆë©”ì´ì…˜ íŠ¸ë¦¬ê±°)
                document.body.classList.add('world-focused'); // bodyì— í´ë˜ìŠ¤ ì¶”ê°€ë¡œ ì „ì²´ ì œì–´
                island.classList.add('focused-island'); // í´ë¦­ëœ ì„¬ ë§ˆí‚¹

                // 3) ì‚¬ì´ë“œ íŒ¨ë„ ë°ì´í„° ì±„ìš°ê¸°
                document.getElementById('panel-title-kr').innerText = islandData[type].kr;
                document.getElementById('panel-title-en').innerText = islandData[type].en;
                document.getElementById('panel-lvl').innerText = `Lv. ${level}`;
                document.getElementById('panel-pts').innerText = points;
                
                // ë ˆë²¨ë°” ì±„ìš°ê¸° (ìµœëŒ€ ë ˆë²¨ 10 ê¸°ì¤€ í¼ì„¼íŠ¸)
                document.getElementById('panel-progress-bar').style.width = `${(level / 10) * 100}%`;

                // ì¼ê¸° ë¦¬ìŠ¤íŠ¸ ìƒì„± (ì´¤ë¼ë¼ë½)
                panelDiaryList.innerHTML = ''; // ì´ˆê¸°í™”
                const logs = islandData[type].logs;
                
                if (logs.length === 0) {
                    panelDiaryList.innerHTML = '<li style="color:#555; font-size:0.8rem; text-align:center; margin-top:20px;">ì•„ì§ ê¸°ë¡ëœ ì´ì•¼ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.</li>';
                } else {
                    logs.forEach((log, index) => {
                        const li = document.createElement('li');
                        li.classList.add('diary-item');
                        li.style.animation = `fadeInUp 0.5s ease forwards ${index * 0.1}s`; // ìˆœì°¨ì  ë“±ì¥
                        li.style.opacity = '0'; // ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘ ì „ ìˆ¨ê¹€
                        li.innerHTML = `
                            <span class="diary-date">${log.date}</span>
                            <span class="diary-snippet">${log.text}</span>
                        `;
                        panelDiaryList.appendChild(li);
                    });
                }

                // 4) ì‚¬ì´ë“œ íŒ¨ë„ ì—´ê¸°
                sidePanel.classList.add('active');
            });
        });

        // --- [NEW] ì§‘ì¤‘ ëª¨ë“œ í•´ì œ (íŒ¨ë„ ë‹«ê¸°) í•¨ìˆ˜ ---
        function closeFocusMode() {
            if (!document.body.classList.contains('world-focused')) return;

            audioClick.play();
            sidePanel.classList.remove('active'); // íŒ¨ë„ ë‹«ê¸°
            document.body.classList.remove('world-focused'); // ì›”ë“œ ë³µê·€
            
            // ëª¨ë“  ì„¬ì—ì„œ focused í´ë˜ìŠ¤ ì œê±°
            islandElements.forEach(isl => isl.classList.remove('focused-island'));
        }

        // ë‹«ê¸° ë²„íŠ¼ í´ë¦­
        panelCloseBtn.addEventListener('click', closeFocusMode);

        // ë°°ê²½(ì›”ë“œ) í´ë¦­ ì‹œ ë‹«ê¸° (ë¹ˆ ê³µê°„ í´ë¦­)
        worldContainer.addEventListener('click', (e) => {
            // ì„¬ì´ë‚˜ íŒ¨ë„ì„ í´ë¦­í•œ ê²Œ ì•„ë‹ˆë¼ë©´ ë‹«ê¸°
            if(document.body.classList.contains('world-focused') && !e.target.closest('.island')) {
                closeFocusMode();
            }
        });

        // ESC í‚¤ ëˆ„ë¥´ë©´ ë‹«ê¸°
        window.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeFocusMode();
        });

        // --- [ì¶”ê°€] ë¦¬ìŠ¤íŠ¸ ì• ë‹ˆë©”ì´ì…˜ ì •ì˜ (ìŠ¤íƒ€ì¼ íƒœê·¸ì— ë„£ì–´ë„ ë¨) ---
        const styleSheet = document.createElement("style");
        styleSheet.innerText = `
            @keyframes fadeInUp {
                from { opacity: 0; transform: translateY(20px); }
                to { opacity: 1; transform: translateY(0); }
            }
        `;
        document.head.appendChild(styleSheet);

        // --- 1. ë²„íŠ¼ í˜¸ë²„ íš¨ê³¼ìŒ (ê¸°ì¡´ ì˜¤ë””ì˜¤ ì¬í™œìš©) ---
        diaryOpenBtn.addEventListener('mouseenter', () => {
            const sound = audioHover.cloneNode();
            sound.volume = 0.05;
            sound.play().catch(()=>{});
        });


        // --- 2. ëª¨ë‹¬ ì—´ê¸°/ë‹«ê¸° ---
        diaryOpenBtn.addEventListener('click', () => {
            audioClick.play();
            diaryModal.classList.add('active');
            // ëª¨ë‹¬ ì—´ ë•Œ í˜„ì¬ ì‹œê°„ ì—…ë°ì´íŠ¸
            const now = new Date();
            diaryDateDisplay.innerText = `${now.getFullYear()}. ${String(now.getMonth()+1).padStart(2,'0')}. ${String(now.getDate()).padStart(2,'0')}. ${['SUN','MON','TUE','WED','THU','FRI','SAT'][now.getDay()]}`;
        });

        // --- 3. ê¸€ì ìˆ˜ ê²€ì¦ ë¡œì§ (30ì ~ 20ì) ---
        diaryTextarea.addEventListener('input', () => {
            const len = diaryTextarea.value.length;
            charCounter.innerText = `${len} / 200`;

            // ê¸°íšì„œ ë°¸ëŸ°ì‹± ê¸°ì¤€: ìµœì†Œ 30ì, ìµœëŒ€ 200ì [cite: 3, 17]
            if (len >= 30 && len <= 200) {
                diarySubmitBtn.disabled = false;
                charCounter.classList.remove('invalid');
            } else {
                diarySubmitBtn.disabled = true;
                charCounter.classList.add('invalid');
            }
        });

        diarySubmitBtn.addEventListener('click', async () => {
            const text = diaryTextarea.value;
            diarySubmitBtn.disabled = true;
            diarySubmitBtn.innerText = "ì •ì›ì‚¬ê°€ ì½ëŠ” ì¤‘... ğŸŒ¿";
            audioClick.play();

            try {
                const result = await realAnalyzeDiary(text);
                
                // [ì¤‘ìš”] ë‚˜ì¤‘ì— ì˜¤ë¸Œ ì—°ì¶œì—ì„œ ì“¸ ìˆ˜ ìˆë„ë¡ ê²°ê³¼ ì €ì¥!
                currentLastResult = result; 

                const now = new Date();
                const dateStr = `${now.getFullYear()}.${String(now.getMonth()+1).padStart(2,'0')}.${String(now.getDate()).padStart(2,'0')}`;

                resultPointUpArea.innerHTML = '';
                
                virtues.forEach((v, index) => {
                    const p = result.points[v] || 0;
                    if (p > 0) {
                        currentPoints[v] += p;
                        islandData[v].logs.unshift({ date: dateStr, text: text });
                        
                        const badge = document.createElement('div');
                        badge.classList.add('point-badge', `badge-${v}`);
                        badge.innerText = `${v.toUpperCase()} +${p}`;
                        badge.style.animationDelay = `${0.8 + (index * 0.1)}s`;
                        resultPointUpArea.appendChild(badge);

                        // í™”ë©´ ì—…ë°ì´íŠ¸
                        const slider = document.getElementById(`rng-${v}`);
                        const display = document.getElementById(`val-${v}`);
                        if (slider) slider.value = currentPoints[v];
                        if (display) display.innerText = currentPoints[v];
                        updateIslandVisual(v, currentPoints[v]);
                    }
                });

                resultComment.innerText = result.comment;

                diaryModal.classList.remove('active');
                setTimeout(() => {
                    resultModal.classList.add('active');
                    // [ì—ëŸ¬ë°©ì§€] íš¨ê³¼ìŒ íŒŒì¼ ì—†ì–´ë„ ì½”ë“œ ì•ˆ ë©ˆì¶”ê²Œ catch ì¶”ê°€
                    audioResult.volume = 0.6;
                    audioResult.play().catch(e => console.warn("ê²°ê³¼ íš¨ê³¼ìŒ ë¡œë“œ ì‹¤íŒ¨:", e));
                }, 500);

                diaryTextarea.value = '';
                charCounter.innerText = "0 / 200";

            } catch (err) {
                console.error(err);
                alert("ìˆ²ì˜ ê¸°ìš´(API)ì´ ë¶ˆì•ˆì •í•©ë‹ˆë‹¤. CORS ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”!");
            } finally {
                diarySubmitBtn.disabled = false;
                diarySubmitBtn.innerText = "ë‚˜ë¬´ ì‹¬ê¸° (ê¸°ë¡)";
            }
        });

        resultCloseBtn.addEventListener('click', () => {
            resultModal.classList.remove('active');

            // ì´ì œ currentLastResultê°€ ì •ì˜ë˜ì–´ ì—ëŸ¬ê°€ ë‚˜ì§€ ì•ŠìŠµë‹ˆë‹¤!
            if (!currentLastResult) return;

            Object.keys(currentLastResult.points).forEach((v, index) => {
                const p = currentLastResult.points[v];
                if (p > 0) {
                    setTimeout(() => {
                        createOrbToIsland(v, p);
                    }, index * 250); // êµ¬ìŠ¬ì´ í•˜ë‚˜ì”© ìˆœì°¨ì ìœ¼ë¡œ ë‚ ì•„ê°
                }
            });
        });

        function createOrbToIsland(virtue, points) {
            const island = document.getElementById(`island-${virtue}`);
            const islandImg = document.getElementById(`img-${virtue}`);
            const islandRect = island.getBoundingClientRect();
            const color = virtueColors[virtue];
            
            const orb = document.createElement('div');
            orb.classList.add('energy-orb');
            orb.style.setProperty('--orb-color', color);
            
            orb.style.left = `${window.innerWidth / 2}px`;
            orb.style.top = `${window.innerHeight / 2}px`;
            document.body.appendChild(orb);

            orb.offsetHeight; 

            setTimeout(() => {
                orb.classList.add('flying');
                const targetX = islandRect.left + islandRect.width / 2;
                const targetY = islandRect.top + islandRect.height / 2;
                orb.style.left = `${targetX - 15}px`; 
                orb.style.top = `${targetY - 15}px`;
            }, 100);

            // [ì¶©ëŒ ì‹œì ]
            setTimeout(() => {
                orb.remove();

                // A. [NEW] íƒ€ê²© íš¨ê³¼ìŒ ì¬ìƒ
                if(audioHit) {
                    const hitSound = audioHit.cloneNode();
                    hitSound.volume = 0.4;
                    hitSound.play().catch(()=>{});
                }

                // B. ì„¬ ë°œê´‘
                islandImg.classList.add('flash-effect');
                setTimeout(() => islandImg.classList.remove('flash-effect'), 700);

                // C. [ê°œì„ ] ì¶©ê²©íŒŒ ìƒì„±
                const ripple = document.createElement('div');
                ripple.classList.add('impact-ripple');
                ripple.style.setProperty('--orb-color', color);
                island.appendChild(ripple);
                setTimeout(() => ripple.classList.add('active'), 10);
                setTimeout(() => ripple.remove(), 600);

                // D. [ê°œì„ ] ì‘ê³  ì˜ˆìœ í…ìŠ¤íŠ¸ íŒì—…
                const popup = document.createElement('div');
                popup.classList.add('floating-point');
                popup.style.setProperty('--orb-color', color);
                popup.innerText = `+${points} PTS`;
                island.appendChild(popup);
                
                setTimeout(() => popup.classList.add('pop'), 10);

                setTimeout(() => {
                    popup.classList.add('fade');
                    setTimeout(() => popup.remove(), 500);
                }, 1200); // í‘œì‹œ ì‹œê°„ë„ ì‚´ì§ ë‹¨ì¶•í•˜ì—¬ ê²½ì¾Œí•˜ê²Œ

            }, 1300);
        }

        diaryCloseX.addEventListener('click', () => { 
            // [ì¤‘ìš”] style.display = 'none' ëŒ€ì‹  í´ë˜ìŠ¤ ì œê±°!
            diaryModal.classList.remove('active'); 
        });

        diaryModal.addEventListener('click', (e) => {
            if (e.target === diaryModal) {
                diaryModal.classList.remove('active');
            }
        });

        // [í•µì‹¬] í¬ì¸íŠ¸ì— ë”°ë¥¸ ë ˆë²¨ ê³„ì‚° í•¨ìˆ˜ 
        function calculateLevel(points) {
            if (points <= 15) return 1;
            if (points <= 30) return 2;
            if (points <= 45) return 3;
            if (points <= 60) return 4;
            if (points <= 75) return 5;
            if (points <= 90) return 6;
            if (points <= 105) return 7;
            if (points <= 125) return 8;
            if (points <= 150) return 9;
            return 10; // Max [cite: 43]
        }

        // [í•µì‹¬] ì„¬ ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateIslandVisual(type, points) {
            const level = calculateLevel(points);
            const imgElement = document.getElementById(`img-${type}`);
            const parentElement = document.getElementById(`island-${type}`);
            
            // ë°ì´í„° ì—…ë°ì´íŠ¸
            parentElement.dataset.points = points;
            
            // ì´ë¯¸ì§€ ì†ŒìŠ¤ êµì²´ (íŒŒì¼ëª… ê·œì¹™: island_type_level.png)
            const newSrc = `Images/island_${type}_${level}.png`;
            
            // í˜„ì¬ ì´ë¯¸ì§€ì™€ ë‹¤ë¥¼ ë•Œë§Œ êµì²´ (ë¶ˆí•„ìš”í•œ ë¦¬ë¡œë“œ ë°©ì§€)
            if (!imgElement.src.includes(newSrc)) {
                // í˜ì´ë“œ íš¨ê³¼ë¥¼ ìœ„í•´ íˆ¬ëª…ë„ ì¡°ì ˆ
                imgElement.style.opacity = 0;
                setTimeout(() => {
                    imgElement.src = newSrc;
                    imgElement.onload = () => {
                        imgElement.style.opacity = 1;
                    };
                    // ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨ ì‹œ(íŒŒì¼ ì—†ì„ ë•Œ) 1ë ˆë²¨ë¡œ ë¡¤ë°±í•˜ëŠ” ì•ˆì „ì¥ì¹˜
                    imgElement.onerror = () => {
                        imgElement.src = `Images/island_${type}_1.png`;
                        imgElement.style.opacity = 1;
                    }
                }, 300);
            }
        }

        // [NEW] ìŠ¬ë¼ì´ë” ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        const virtues = ['courage', 'wisdom', 'kindness', 'diligence', 'serenity'];
        virtues.forEach(v => {
            const slider = document.getElementById(`rng-${v}`);
            const display = document.getElementById(`val-${v}`);
            
            slider.addEventListener('input', (e) => {
                const points = parseInt(e.target.value);
                display.innerText = points;
                updateIslandVisual(v, points);
            });
        });

        function createStars() {
            const count = 100;
            for(let i=0; i<count; i++) {
                const star = document.createElement('div');
                star.classList.add('star');
                const x = Math.random() * 100;
                const y = Math.random() * 70; 
                const size = Math.random() * 2 + 1;
                const duration = Math.random() * 3 + 2; 
                const opacity = Math.random() * 0.7 + 0.3;
                star.style.left = `${x}%`; star.style.top = `${y}%`;
                star.style.width = `${size}px`; star.style.height = `${size}px`;
                star.style.setProperty('--duration', `${duration}s`);
                star.style.setProperty('--opacity', opacity);
                starsContainer.appendChild(star);
            }
        }
        createStars();

        function updateDayNightCycle() {
            let now;
            if (window.manualTime) { now = new Date(); now.setHours(window.manualTime.h, window.manualTime.m); } else { now = new Date(); }
            const year = now.getFullYear(); const month = String(now.getMonth() + 1).padStart(2, '0'); const date = String(now.getDate()).padStart(2, '0');
            const days = ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT']; const dayName = days[now.getDay()];
            hudDate.innerText = `${year}. ${month}. ${date}. ${dayName}`;
            const hours = String(now.getHours()).padStart(2, '0'); const minutes = String(now.getMinutes()).padStart(2, '0');
            hudTime.innerText = `${hours}:${minutes}`;
            const h = now.getHours();
            let skyGradient = ''; let starsOpacity = 0;
            if (h >= 5 && h < 7) { skyGradient = 'linear-gradient(135deg, #2c3e50 0%, #4ca1af 60%, #ff9966 100%)'; starsOpacity = 0; }
            else if (h >= 7 && h < 17) { skyGradient = 'linear-gradient(135deg, #2980b9 0%, #6dd5fa 50%, #ffffff 100%)'; starsOpacity = 0; }
            else if (h >= 17 && h < 19) { skyGradient = 'linear-gradient(135deg, #3e5151 0%, #decba4 50%, #ff7e5f 100%)'; starsOpacity = 0.3; }
            else { skyGradient = 'linear-gradient(160deg, #0f2027 0%, #203a43 60%, #2c5364 100%)'; starsOpacity = 1; }
            skyBg.style.background = skyGradient; starsContainer.style.opacity = starsOpacity;
        }
        setInterval(updateDayNightCycle, 1000); updateDayNightCycle(); 

        let width, height;
        function resize() { width = window.innerWidth; height = window.innerHeight; canvas.width = width; canvas.height = height; }
        window.addEventListener('resize', resize); resize();

        let mouseX = 0; let mouseY = 0; let targetX = 0; let targetY = 0;
        const parallaxSensitivity = 0.2; 
        document.addEventListener('mousemove', (e) => {
            mouseX = (e.clientX - width / 2) / (width / 2);
            mouseY = (e.clientY - height / 2) / (height / 2);
            tooltip.style.left = e.clientX + 'px'; tooltip.style.top = e.clientY + 'px';
        });

        function updateParallax() {
            targetX += (mouseX - targetX) * 0.05; targetY += (mouseY - targetY) * 0.05;
            const allObjects = document.querySelectorAll('.scene-object');
            allObjects.forEach(obj => {
                const depth = parseFloat(obj.dataset.depth); const baseX = parseFloat(obj.dataset.baseX); const baseY = parseFloat(obj.dataset.baseY);
                const moveX = targetX * depth * width * -1 * parallaxSensitivity; const moveY = targetY * depth * height * -1 * parallaxSensitivity;
                obj.style.left = `${baseX}%`; obj.style.top = `${baseY}%`; obj.style.transform = `translate(calc(-50% + ${moveX}px), ${moveY}px)`;
            });
            requestAnimationFrame(updateParallax);
        }

        function createShards() {
            const shardCount = 20;
            for(let i=0; i<shardCount; i++) {
                const shard = document.createElement('div'); shard.classList.add('shard', 'scene-object'); 
                const size = 5 + Math.random() * 20; shard.style.width = `${size}px`; shard.style.height = `${size}px`;
                shard.dataset.baseX = Math.random() * 100; shard.dataset.baseY = Math.random() * 90; shard.dataset.depth = (Math.random() * 0.1).toFixed(3); 
                const p1 = Math.floor(Math.random() * 100); const p2 = Math.floor(Math.random() * 100); const p3 = Math.floor(Math.random() * 100);
                shard.style.clipPath = `polygon(${p1}% 0%, 100% ${p2}%, ${p3}% 100%)`; shard.style.animationDelay = `${Math.random() * 5}s`;
                islandsContainer.appendChild(shard);
            }
        }
        createShards(); 

        islandElements.forEach(island => {
            island.addEventListener('mouseenter', () => {
                if(island.classList.contains('visible')) {
                    const sound = audioHover.cloneNode(); sound.volume = 0.05; sound.play().catch(()=>{});
                    tooltipEn.innerText = island.dataset.nameEn;
                    tooltipKr.innerText = island.dataset.nameKr;
                    
                    // íˆ´íŒì— í˜„ì¬ ë ˆë²¨ í‘œì‹œ ì¶”ê°€
                    const points = parseInt(island.dataset.points);
                    const lvl = calculateLevel(points);
                    tooltipLvl.innerText = `Lv. ${lvl} (${points}pts)`;
                    
                    tooltip.classList.add('active');
                }
            });
            island.addEventListener('mouseleave', () => { tooltip.classList.remove('active'); });
        });

        let particles = []; const particleCount = 200; let isClearing = false; let isGardenMode = false;
        class Particle {
            constructor(isIntro = true) { this.isIntro = isIntro; this.markedForDeletion = false; this.reset(true); }
            reset(initial = false) {
                if (this.isIntro) {
                    this.x = Math.random() * width; this.y = Math.random() * height; this.z = Math.random(); 
                    this.size = 100 + this.z * 300; this.speed = 0.5 + this.z * 0.5; this.opacity = 0.4 + Math.random() * 0.5;
                    this.vx = this.speed; this.vy = 0; this.type = 'cloud';
                } else {
                    this.x = width + 50; const rand = Math.random();
                    if (rand < 0.8) { this.y = (height * 0.7) + Math.random() * (height * 0.3); } else { this.y = Math.random() * (height * 0.5); }
                    const typeRand = Math.random();
                    if (typeRand > 0.8) { this.type = 'mini-cloud'; this.size = 30 + Math.random() * 60; this.speed = 0.5 + Math.random() * 0.5; this.opacity = 0.15 + Math.random() * 0.2; } 
                    else { this.type = 'wind'; this.size = 1 + Math.random() * 2; this.speed = 2.5 + Math.random() * 2; this.opacity = 0.05 + Math.random() * 0.1; }
                    this.vx = -this.speed; this.vy = (Math.random() - 0.5) * 0.2;
                }
                this.explodeVx = 0; this.explodeVy = 0;
            }
            update() {
                if (this.isIntro) {
                    if (!isClearing) { this.x += this.vx; if (this.x - this.size > width) { this.x = -this.size; this.y = Math.random() * height; } } 
                    else {
                        const centerX = width / 2; const centerY = height / 2; const dx = this.x - centerX; const dy = this.y - centerY;
                        const angle = Math.atan2(dy, dx); const force = 8; 
                        this.explodeVx += Math.cos(angle) * 0.8; this.explodeVy += Math.sin(angle) * 0.8;
                        this.x += (Math.cos(angle) * force) + this.explodeVx; this.y += (Math.sin(angle) * force) + this.explodeVy;
                        this.opacity -= 0.02; if (this.opacity <= 0) { this.markedForDeletion = true; }
                    }
                } else {
                    this.x += this.vx; this.y += this.vy; if (this.x < -200) { this.markedForDeletion = true; }
                }
            }
            draw() {
                if (this.opacity <= 0) return; ctx.beginPath();
                if (this.type === 'cloud' || this.type === 'mini-cloud') {
                    const gradient = ctx.createRadialGradient(this.x, this.y, this.size * 0.1, this.x, this.y, this.size);
                    gradient.addColorStop(0, `rgba(255, 255, 255, ${this.opacity})`); gradient.addColorStop(0.6, `rgba(240, 248, 255, ${this.opacity * 0.5})`); gradient.addColorStop(1, `rgba(255, 255, 255, 0)`);
                    ctx.fillStyle = gradient; ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2); ctx.fill();
                } else if (this.type === 'wind') {
                    ctx.strokeStyle = `rgba(255, 255, 255, ${this.opacity})`; ctx.lineWidth = 1;
                    ctx.moveTo(this.x, this.y); ctx.lineTo(this.x + this.size * 15, this.y); ctx.stroke();
                }
            }
        }

        function initIntroParticles() { for (let i = 0; i < particleCount; i++) particles.push(new Particle(true)); }
        function spawnGardenParticles() { if (!isGardenMode) return; if (particles.length < 100) { particles.push(new Particle(false)); } }
        function animateParticles() {
            ctx.clearRect(0, 0, width, height); for (let i = 0; i < particles.length; i++) { particles[i].update(); particles[i].draw(); }
            particles = particles.filter(p => !p.markedForDeletion);
            if (isGardenMode) { spawnGardenParticles(); }
            requestAnimationFrame(animateParticles);
        }

        enterBtn.addEventListener('mouseenter', () => { const sound = audioHover.cloneNode(); sound.volume = 0.05; sound.play().catch(()=>{}); });
        enterBtn.addEventListener('click', () => {
            // [ì¦‰ì‹œ ì‹¤í–‰] íš¨ê³¼ìŒ, UI í˜ì´ë“œì•„ì›ƒ, ì›”ë“œ í™•ëŒ€
            audioClick.play();
            
            // [ìˆ˜ì •] í´ë¦­í•˜ìë§ˆì êµ¬ë¦„ ê±·íˆëŠ” ì†Œë¦¬ì™€ ë°”ëŒ ì†Œë¦¬ ì¦‰ì‹œ ì¬ìƒ
            audioClear.volume = 0.2;
            audioClear.play();
            
            audioAmbiance.volume = 0.3; // ë°”ëŒ ì†Œë¦¬ëŠ” ì€ì€í•˜ê²Œ
            audioAmbiance.play();

            uiLayer.style.opacity = '0';
            isClearing = true;
            worldContainer.style.transform = "scale(2.0)"; 

            setTimeout(() => {
                isGardenMode = true;
                const allSceneObjects = document.querySelectorAll('.scene-object');
                allSceneObjects.forEach((obj) => { obj.classList.add('visible'); });

                if (diaryOpenBtn) diaryOpenBtn.classList.add('visible');

                cloudFloor.style.opacity = '1'; 
                hudLayer.style.opacity = '1'; 
                updateParallax();
            }, 1000);

            setTimeout(() => { 
                uiLayer.style.display = 'none'; 
            }, 1500);
        });

        initIntroParticles(); animateParticles();
        // --- [ì¶”ê°€] F3 í‚¤ë¡œ ì •ì›ì‚¬ ëª¨ë“œ í† ê¸€ ---
        window.addEventListener('keydown', (e) => {
            if (e.key === 'F3') {
                e.preventDefault(); // ë¸Œë¼ìš°ì € ìì²´ 'ì°¾ê¸°' ì°½ì´ ëœ¨ëŠ” ê±¸ ë§‰ìŒ
                
                // í˜„ì¬ ìƒíƒœê°€ blockì´ë©´ ìˆ¨ê¸°ê³ , ì•„ë‹ˆë©´ ë³´ì—¬ì¤Œ
                if (devPanel.style.display === 'block') {
                    devPanel.style.display = 'none';
                } else {
                    devPanel.style.display = 'block';
                }
            }
        });
    </script>
</body>
</html> 